<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠå¤©æœºå™¨äººé¡¹ç›® - LangChain4j å­¦ä¹ æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white text-gray-800 antialiased">
    <div class="flex min-h-screen">
        


<aside class="w-[280px] fixed h-screen bg-white border-r border-gray-200 overflow-y-auto pb-8">
  <div class="p-6">
    <div class="flex items-center gap-3 mb-8">
      <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
      <div>
        <h1 class="font-bold text-gray-900">LangChain4j</h1>
        <p class="text-xs text-gray-500">å…¥é—¨æŒ‡å—</p>
      </div>
    </div>

    <div class="space-y-6">
      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">å¿«é€Ÿå¼€å§‹</h3>
        <ul class="space-y-1">
          <li><a href="index.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="index">æ¦‚è§ˆ</a></li>
          <li><a href="getting-started.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="getting-started">ç¯å¢ƒå‡†å¤‡</a></li>
          <li><a href="core-concepts.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="core-concepts">æ ¸å¿ƒæ¦‚å¿µ</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">æ ¸å¿ƒåŠŸèƒ½</h3>
        <ul class="space-y-1">
          <li><a href="embedding-models.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="embedding-models">Embedding æ¨¡å‹</a></li>
          <li><a href="prompt-templates.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="prompt-templates">Prompt æ¨¡æ¿</a></li>
          <li><a href="output-parsers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="output-parsers">è¾“å‡ºè§£æ</a></li>
          <li><a href="model-providers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="model-providers">æ¨¡å‹æä¾›å•†</a></li>
          <li><a href="function-calling-deep.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="function-calling-deep">å‡½æ•°è°ƒç”¨</a></li>
          <li><a href="advanced-features.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="advanced-features">é«˜çº§ç‰¹æ€§</a></li>
          <li><a href="multimodal-full.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="multimodal-full">å¤šæ¨¡æ€</a></li>
        </ul>
      </div>

       <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">RAG å®Œæ•´æŒ‡å—</h3>
        <ul class="space-y-1">
          <li><a href="rag-intro.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-intro">RAG ç®€ä»‹</a></li>
          <li><a href="rag-setup.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-setup">RAG ç¯å¢ƒæ­å»º</a></li>
          <li><a href="rag-implementation.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-implementation">RAG å®ç°</a></li>
          <li><a href="rag-advanced.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-advanced">RAG é«˜çº§</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">é¡¹ç›®å®æˆ˜</h3>
        <ul class="space-y-1">
          <li><a href="project-chatbot.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="project-chatbot">èŠå¤©æœºå™¨äºº</a></li>
          <li><a href="project-ai-assistant.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="project-ai-assistant">AIåŠ©æ‰‹</a></li>
          <li><a href="project-rag-kb.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="project-rag-kb">RAGçŸ¥è¯†åº“</a></li>
          <li><a href="practice.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="practice">ç»¼åˆå®æˆ˜</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">æœ€ä½³å®è·µ</h3>
        <ul class="space-y-1">
          <li><a href="best-practices.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="best-practices">æœ€ä½³å®è·µ</a></li>
          <li><a href="testing-strategies.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="testing-strategies">æµ‹è¯•ç­–ç•¥</a></li>
          <li><a href="performance-tuning.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="performance-tuning">æ€§èƒ½ä¼˜åŒ–</a></li>
          <li><a href="deep-dive.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="deep-dive">æ·±åº¦è§£æ</a></li>
          <li><a href="error-handling.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="error-handling">é”™è¯¯å¤„ç†</a></li>
          <li><a href="moderation-safety.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="moderation-safety">å†…å®¹å®¡æ ¸</a></li>
          <li><a href="troubleshooting.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="troubleshooting">æ•…éšœæ’æŸ¥</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">é¢è¯•å‡†å¤‡</h3>
        <ul class="space-y-1">
          <li><a href="interview-prep.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="interview-prep">é¢è¯•å‡†å¤‡</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">å…¶ä»–</h3>
        <ul class="space-y-1">
          <li><a href="search.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="search">å‘é‡æœç´¢</a></li>
          <li><a href="chat-listeners.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="chat-listeners">ç›‘å¬å™¨</a></li>
          <li><a href="faq.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="faq">å¸¸è§é—®é¢˜</a></li>
          <li><a href="cost-optimization.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="cost-optimization">æˆæœ¬ä¼˜åŒ–</a></li>
          <li><a href="deployment.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="deployment">éƒ¨ç½²ä¸Šçº¿</a></li>
          <li><a href="integrations.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="integrations">æ¡†æ¶é›†æˆ</a></li>
          <li><a href="examples.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="examples">å®æˆ˜ç¤ºä¾‹</a></li>
        </ul>
      </div>
    </div>
  </div>
</aside>
<!-- class="block px-4 py-2.5 text-sm bg-indigo-50 text-indigo-700 font-medium rounded-md transition-all text-center" -->
<!-- class="block px-4 py-2.5 text-sm bg-indigo-50 text-indigo-700 font-medium rounded-md transition-all text-center" -->
<!-- class="block px-4 py-2.5 text-sm bg-indigo-50 text-indigo-700 font-medium rounded-md transition-all text-center" -->


        <main class="flex-1 ml-[280px] px-8 py-12 max-w-7xl mx-auto">>
            <div class="mb-8 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-semibold">2025-02-14</span>
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-semibold">é¡¹ç›®å®æˆ˜</span>
                    <span class="bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-xs font-semibold">ä¸­çº§éš¾åº¦</span>
                </div>
            </div>

            <h1 class="text-5xl font-bold text-gray-900 mb-6">èŠå¤©æœºå™¨äººé¡¹ç›®</h1>

            <div class="mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ</h2>
                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 border border-indigo-100 rounded-xl p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-indigo-600 mb-2">WebSocket</div>
                            <div class="text-gray-600 text-sm">å®æ—¶åŒå‘é€šä¿¡</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-purple-600 mb-2">ç¾¤èŠ</div>
                            <div class="text-gray-600 text-sm">å¤šç”¨æˆ·èŠå¤©å®¤</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-600 mb-2">æ¶ˆæ¯æŒä¹…åŒ–</div>
                            <div class="text-gray-600 text-sm">å†å²è®°å½•æŸ¥è¯¢</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-blue-600 mb-2">AIå¢å¼º</div>
                            <div class="text-gray-600 text-sm">æ™ºèƒ½å¯¹è¯ä½“éªŒ</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-12 bg-blue-50 border border-blue-100 rounded-lg p-6">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ğŸ’¡</span>
                    <div>
                        <h3 class="font-bold text-gray-900 mb-2">å­¦ä¹ ç›®æ ‡</h3>
                        <ul class="text-gray-700 space-y-2 text-sm">
                            <li>â€¢ æŒæ¡WebSocketå®æ—¶é€šä¿¡çš„å®Œæ•´å®ç°</li>
                            <li>â€¢ ç†è§£å¤šç”¨æˆ·èŠå¤©å®¤çš„çŠ¶æ€ç®¡ç†</li>
                            <li>â€¢ å­¦ä¹ æ¶ˆæ¯æŒä¹…åŒ–å’Œå†å²è®°å½•æŸ¥è¯¢</li>
                            <li>â€¢ å®ç°ç”¨æˆ·åœ¨çº¿çŠ¶æ€å’Œå®æ—¶é€šçŸ¥</li>
                            <li>â€¢ é›†æˆLangChain4jå¢å¼ºå¯¹è¯èƒ½åŠ›</li>
                            <li>â€¢ å®ç°å¤šBotåä½œçš„èŠå¤©åœºæ™¯</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mb-12">
                <div class="flex items-center gap-3 mb-8">
                    <div class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold">ğŸ—ï¸</div>
                    <h2 class="text-2xl font-bold text-gray-900">é¡¹ç›®æ¶æ„è®¾è®¡</h2>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">ç³»ç»Ÿæ¶æ„å›¾</h3>
                    <pre class="bg-gray-900 text-gray-100 p-6 rounded-lg overflow-x-auto text-sm">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®¢æˆ·ç«¯å±‚ (React)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  èŠå¤©ç•Œé¢    â”‚  â”‚  ç¾¤èŠåˆ—è¡¨    â”‚  â”‚  è®¾ç½®é¢æ¿    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Boot åç«¯å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚WebSocket     â”‚  â”‚  ChatService â”‚  â”‚  MessageRepo  â”‚           â”‚
â”‚  â”‚  Controller  â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â†“                  â†“                    â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  åœ¨çº¿ç”¨æˆ·    â”‚  â”‚  èŠå¤©å®¤      â”‚  â”‚  æ¶ˆæ¯æŒä¹…åŒ–  â”‚           â”‚
â”‚  â”‚  ç®¡ç†å™¨      â”‚  â”‚  ç®¡ç†å™¨      â”‚  â”‚  æœåŠ¡        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LangChain4j AIå¢å¼ºå±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ChatAgent   â”‚  â”‚  RAGService  â”‚  â”‚  ToolAgent   â”‚           â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚  Redis       â”‚  â”‚  Vector DB   â”‚           â”‚
â”‚  â”‚  (ç”¨æˆ·/æ¶ˆæ¯)  â”‚  â”‚  (åœ¨çº¿çŠ¶æ€)  â”‚  â”‚  (çŸ¥è¯†åº“)     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white border border-gray-200 rounded-lg p-5">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <span class="text-indigo-600">ğŸ”Œ</span> æ ¸å¿ƒç»„ä»¶
                        </h4>
                        <ul class="text-gray-700 space-y-2 text-sm">
                            <li>â€¢ <strong>ChatWebSocketHandler</strong> - WebSocketæ¶ˆæ¯å¤„ç†</li>
                            <li>â€¢ <strong>ChatService</strong> - èŠå¤©ä¸šåŠ¡é€»è¾‘</li>
                            <li>â€¢ <strong>RoomManager</strong> - èŠå¤©å®¤ç®¡ç†</li>
                            <li>â€¢ <strong>OnlineUserService</strong> - åœ¨çº¿ç”¨æˆ·ç®¡ç†</li>
                            <li>â€¢ <strong>MessageRepository</strong> - æ¶ˆæ¯æŒä¹…åŒ–</li>
                        </ul>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-5">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <span class="text-green-600">ğŸ¤–</span> AIå¢å¼ºåŠŸèƒ½
                        </h4>
                        <ul class="text-gray-700 space-y-2 text-sm">
                            <li>â€¢ <strong>ChatAgent</strong> - æ™ºèƒ½å¯¹è¯Agent</li>
                            <li>â€¢ <strong>MultiBotCoordinator</strong> - å¤šBotåè°ƒ</li>
                            <li>â€¢ <strong>ContextMemory</strong> - å¯¹è¯ä¸Šä¸‹æ–‡è®°å¿†</li>
                            <li>â€¢ <strong>ToolIntegration</strong> - å·¥å…·è°ƒç”¨æ”¯æŒ</li>
                            <li>â€¢ <strong>RAGIntegration</strong> - çŸ¥è¯†åº“æ£€ç´¢</li>
                        </ul>
                    </div>
                </div>
            </div>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">1</span>
                    Spring Boot WebSocketåç«¯å®ç°
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.1 é¡¹ç›®ä¾èµ–é…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">pom.xml</div>
                        <div class="text-xs text-gray-400">Mavené…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-xml">&lt;dependencies&gt;
    &lt;!-- Spring Boot Starter --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- LangChain4j --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;
        &lt;artifactId&gt;langchain4j-open-ai&lt;/artifactId&gt;
        &lt;version&gt;0.36.2&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- PostgreSQL --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
        &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- Lombok --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.2 WebSocketé…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">WebSocketConfig.java</div>
                        <div class="text-xs text-gray-400">WebSocketé…ç½®ç±»</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.*;

/**
 * WebSocketé…ç½®ç±»
 * é…ç½®æ¶ˆæ¯ä»£ç†å’Œç«¯ç‚¹æ˜ å°„
 */
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        // å¯ç”¨ç®€å•æ¶ˆæ¯ä»£ç†ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
        // /topic ä¸»é¢˜æ¶ˆæ¯ï¼ˆå¹¿æ’­ç»™æ‰€æœ‰è®¢é˜…è€…ï¼‰
        // /queue é˜Ÿåˆ—æ¶ˆæ¯ï¼ˆç‚¹å¯¹ç‚¹å‘é€ï¼‰
        config.enableSimpleBroker("/topic", "/queue");

        // è®¾ç½®å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„å‰ç¼€
        config.setApplicationDestinationPrefixes("/app");

        // è®¾ç½®ç”¨æˆ·ç›®çš„åœ°å‰ç¼€
        config.setUserDestinationPrefix("/user");
    }

    @Override
    public void registerStompEndpoints(ompRegistry) {
        // æ³¨å†ŒWebSocketç«¯ç‚¹
        ompRegistry.addEndpoint("/ws-chat")
                  .setAllowedOriginPatterns("*")  // ç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶åŸŸå
                  .withSockJS();  // æ”¯æŒSockJSå›é€€æ–¹æ¡ˆ
    }
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.3 æ¶ˆæ¯å®ä½“ç±»</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">Message.java</div>
                        <div class="text-xs text-gray-400">æ¶ˆæ¯å®ä½“</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.entity;

import jakarta.persistence.*;
import lombok.*;
import java.time.LocalDateTime;

/**
 * èŠå¤©æ¶ˆæ¯å®ä½“
 * å­˜å‚¨æ‰€æœ‰èŠå¤©æ¶ˆæ¯ç”¨äºå†å²è®°å½•æŸ¥è¯¢
 */
@Entity
@Table(name = "messages", indexes = {
    @Index(name = "idx_room_created", columnList = "room_id,created_at"),
    @Index(name = "idx_sender", columnList = "sender_id")
})
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Message {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * èŠå¤©å®¤ID
     */
    @Column(nullable = false)
    private String roomId;

    /**
     * å‘é€è€…ID
     */
    @Column(nullable = false)
    private String senderId;

    /**
     * å‘é€è€…åç§°
     */
    @Column(nullable = false)
    private String senderName;

    /**
     * æ¶ˆæ¯å†…å®¹
     */
    @Column(nullable = false, length = 5000)
    private String content;

    /**
     * æ¶ˆæ¯ç±»å‹ï¼šTEXT, IMAGE, FILE, SYSTEM
     */
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private MessageType type = MessageType.TEXT;

    /**
     * æ˜¯å¦ä¸ºAIç”Ÿæˆçš„æ¶ˆæ¯
     */
    @Column(nullable = false)
    private Boolean isAiGenerated = false;

    /**
     * AIæ¨¡å‹åç§°ï¼ˆå¦‚æœæ˜¯AIæ¶ˆæ¯ï¼‰
     */
    private String aiModel;

    /**
     * å…³è”çš„å·¥å…·è°ƒç”¨IDï¼ˆå¦‚æœæœ‰ï¼‰
     */
    private Long toolCallId;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    @Column(nullable = false)
    private LocalDateTime createdAt;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
    }

    /**
     * æ¶ˆæ¯ç±»å‹æšä¸¾
     */
    public enum MessageType {
        TEXT,      // æ–‡æœ¬æ¶ˆæ¯
        IMAGE,     // å›¾ç‰‡æ¶ˆæ¯
        FILE,      // æ–‡ä»¶æ¶ˆæ¯
        SYSTEM,    // ç³»ç»Ÿæ¶ˆæ¯
        JOIN,      // åŠ å…¥æˆ¿é—´
        LEAVE,     // ç¦»å¼€æˆ¿é—´
        TYPING     // æ­£åœ¨è¾“å…¥
    }
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.4 MessageRepositoryæ¥å£</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">MessageRepository.java</div>
                        <div class="text-xs text-gray-400">æ¶ˆæ¯æ•°æ®è®¿é—®å±‚</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.repository;

import com.example.chatbot.entity.Message;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;
import java.util.List;

/**
 * æ¶ˆæ¯ä»“å‚¨æ¥å£
 * æä¾›æ¶ˆæ¯æŒä¹…åŒ–å’ŒæŸ¥è¯¢åŠŸèƒ½
 */
@Repository
public interface MessageRepository extends JpaRepository&lt;Message, Long&gt; {

    /**
     * æŸ¥è¯¢æŒ‡å®šèŠå¤©å®¤çš„æ¶ˆæ¯
     * @param roomId èŠå¤©å®¤ID
     * @param pageable åˆ†é¡µå‚æ•°
     * @return æ¶ˆæ¯åˆ†é¡µç»“æœ
     */
    Page&lt;Message&gt; findByRoomIdOrderByCreatedAtAsc(String roomId, Pageable pageable);

    /**
     * æŸ¥è¯¢æŒ‡å®šèŠå¤©å®¤æœ€è¿‘çš„æ¶ˆæ¯
     * @param roomId èŠå¤©å®¤ID
     * @param limit é™åˆ¶æ•°é‡
     * @return æ¶ˆæ¯åˆ—è¡¨
     */
    @Query("SELECT m FROM Message m WHERE m.roomId = :roomId " +
           "ORDER BY m.createdAt DESC LIMIT :limit")
    List&lt;Message&gt; findRecentMessages(@Param("roomId") String roomId,
                                        @Param("limit") int limit);

    /**
     * æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µçš„æ¶ˆæ¯
     * @param roomId èŠå¤©å®¤ID
     * @param startTime å¼€å§‹æ—¶é—´
     * @param endTime ç»“æŸæ—¶é—´
     * @return æ¶ˆæ¯åˆ—è¡¨
     */
    List&lt;Message&gt; findByRoomIdAndCreatedAtBetween(
        String roomId,
        LocalDateTime startTime,
        LocalDateTime endTime
    );

    /**
     * ç»Ÿè®¡èŠå¤©å®¤æ¶ˆæ¯æ•°é‡
     * @param roomId èŠå¤©å®¤ID
     * @return æ¶ˆæ¯æ€»æ•°
     */
    long countByRoomId(String roomId);

    /**
     * æŸ¥è¯¢ç”¨æˆ·åœ¨æŒ‡å®šèŠå¤©å®¤å‘é€çš„æ¶ˆæ¯
     * @param roomId èŠå¤©å®¤ID
     * @param senderId å‘é€è€…ID
     * @return æ¶ˆæ¯åˆ—è¡¨
     */
    List&lt;Message&gt; findByRoomIdAndSenderIdOrderByCreatedAtAsc(
        String roomId,
        String senderId
    );

    /**
     * åˆ é™¤æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ¶ˆæ¯ï¼ˆç”¨äºæ¸…ç†å†å²æ¶ˆæ¯ï¼‰
     * @param beforeDate æ—¥æœŸ
     * @return åˆ é™¤çš„è®°å½•æ•°
     */
    @Query("DELETE FROM Message m WHERE m.createdAt &lt; :beforeDate")
    int deleteMessagesOlderThan(@Param("beforeDate") LocalDateTime beforeDate);

    /**
     * æœç´¢åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯
     */
    @Query("SELECT m FROM Message m WHERE m.roomId = :roomId AND " +
           "LOWER(m.content) LIKE LOWER(CONCAT('%', :keyword, '%'))")
    List&lt;Message&gt; searchByKeyword(@Param("roomId") String roomId,
                                   @Param("keyword") String keyword);
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.5 èŠå¤©å®¤å®ä½“ç±»</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatRoom.java</div>
                        <div class="text-xs text-gray-400">èŠå¤©å®¤å®ä½“</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.entity;

import jakarta.persistence.*;
import lombok.*;
import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;

/**
 * èŠå¤©å®¤å®ä½“
 * ç®¡ç†èŠå¤©å®¤åŸºæœ¬ä¿¡æ¯å’Œæˆå‘˜
 */
@Entity
@Table(name = "chat_rooms", indexes = {
    @Index(name = "idx_creator", columnList = "created_by")
})
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ChatRoom {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * èŠå¤©å®¤å”¯ä¸€ID
     */
    @Column(unique = true, nullable = false)
    private String roomId;

    /**
     * èŠå¤©å®¤åç§°
     */
    @Column(nullable = false)
    private String name;

    /**
     * èŠå¤©å®¤æè¿°
     */
    @Column(length = 1000)
    private String description;

    /**
     * èŠå¤©å®¤ç±»å‹ï¼šPUBLIC, PRIVATE, GROUP
     */
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private RoomType type = RoomType.PUBLIC;

    /**
     * åˆ›å»ºè€…ID
     */
    @Column(nullable = false)
    private String createdBy;

    /**
     * åˆ›å»ºè€…åç§°
     */
    @Column(nullable = false)
    private String createdByName;

    /**
     * æˆå‘˜IDé›†åˆï¼ˆç®€åŒ–å­˜å‚¨ï¼Œç”Ÿäº§ç¯å¢ƒå¯ç”¨å…³è”è¡¨ï¼‰
     */
    @ElementCollection
    @CollectionTable(name = "room_members", joinColumns = @JoinColumn(name = "room_id"))
    @Column(name = "user_id")
    private Set&lt;String&gt; memberIds = new HashSet&lt;&gt;();

    /**
     * æœ€å¤§æˆå‘˜æ•°
     */
    @Column
    private Integer maxMembers;

    /**
     * æ˜¯å¦å¯ç”¨AIåŠ©æ‰‹
     */
    @Column(nullable = false)
    @Builder.Default
    private Boolean aiEnabled = true;

    /**
     * AI Botåç§°
     */
    @Column(length = 100)
    private String aiBotName = "AIåŠ©æ‰‹";

    /**
     * æ˜¯å¦å¯ç”¨çŸ¥è¯†åº“RAG
     */
    @Column(nullable = false)
    @Builder.Default
    private Boolean ragEnabled = false;

    /**
     * çŸ¥è¯†åº“IDï¼ˆå¦‚æœå¯ç”¨RAGï¼‰
     */
    private Long knowledgeBaseId;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    @Column(nullable = false)
    private LocalDateTime createdAt;

    /**
     * æœ€åæ´»è·ƒæ—¶é—´
     */
    private LocalDateTime lastActiveAt;

    @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        lastActiveAt = LocalDateTime.now();
    }

    /**
     * èŠå¤©å®¤ç±»å‹æšä¸¾
     */
    public enum RoomType {
        PUBLIC,  // å…¬å¼€èŠå¤©å®¤
        PRIVATE, // ç§èŠ
        GROUP    // ç¾¤èŠ
    }

    /**
     * æ·»åŠ æˆå‘˜
     */
    public void addMember(String userId) {
        if (maxMembers != null &amp;&amp; memberIds.size() &gt;= maxMembers) {
            throw new IllegalStateException("èŠå¤©å®¤å·²æ»¡å‘˜");
        }
        memberIds.add(userId);
        lastActiveAt = LocalDateTime.now();
    }

    /**
     * ç§»é™¤æˆå‘˜
     */
    public void removeMember(String userId) {
        memberIds.remove(userId);
        lastActiveAt = LocalDateTime.now();
    }

    /**
     * æ£€æŸ¥æ˜¯å¦ä¸ºæˆå‘˜
     */
    public boolean isMember(String userId) {
        return memberIds.contains(userId);
    }

    /**
     * è·å–æˆå‘˜æ•°é‡
     */
    public int getMemberCount() {
        return memberIds.size();
    }
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">2</span>
                    ChatServiceä¸šåŠ¡é€»è¾‘
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">2.1 ChatServiceæ¥å£å®šä¹‰</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatService.java</div>
                        <div class="text-xs text-gray-400">èŠå¤©æœåŠ¡æ¥å£</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.service;

import com.example.chatbot.dto.*;
import org.springframework.data.domain.Page;

import java.util.List;

/**
 * èŠå¤©æœåŠ¡æ¥å£
 * å®šä¹‰èŠå¤©ç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡æ“ä½œ
 */
public interface ChatService {

    /**
     * åˆ›å»ºèŠå¤©å®¤
     * @param request åˆ›å»ºè¯·æ±‚
     * @return èŠå¤©å®¤ä¿¡æ¯
     */
    ChatRoomDTO createRoom(CreateRoomRequest request);

    /**
     * åŠ å…¥èŠå¤©å®¤
     * @param roomId èŠå¤©å®¤ID
     * @param userId ç”¨æˆ·ID
     * @param userName ç”¨æˆ·å
     */
    void joinRoom(String roomId, String userId, String userName);

    /**
     * ç¦»å¼€èŠå¤©å®¤
     * @param roomId èŠå¤©å®¤ID
     * @param userId ç”¨æˆ·ID
     */
    void leaveRoom(String roomId, String userId);

    /**
     * å‘é€æ¶ˆæ¯
     * @param request å‘é€æ¶ˆæ¯è¯·æ±‚
     * @return æ¶ˆæ¯å®ä½“
     */
    MessageDTO sendMessage(SendMessageRequest request);

    /**
     * è·å–èŠå¤©å®¤å†å²æ¶ˆæ¯
     * @param roomId èŠå¤©å®¤ID
     * @param page é¡µç 
     * @param size æ¯é¡µå¤§å°
     * @return æ¶ˆæ¯åˆ†é¡µç»“æœ
     */
    Page&lt;MessageDTO&gt; getRoomMessages(String roomId, int page, int size);

    /**
     * è·å–ç”¨æˆ·çš„èŠå¤©å®¤åˆ—è¡¨
     * @param userId ç”¨æˆ·ID
     * @return èŠå¤©å®¤åˆ—è¡¨
     */
    List&lt;ChatRoomDTO&gt; getUserRooms(String userId);

    /**
     * æ›´æ–°èŠå¤©å®¤è®¾ç½®
     * @param roomId èŠå¤©å®¤ID
     * @param request æ›´æ–°è¯·æ±‚
     */
    void updateRoomSettings(String roomId, UpdateRoomRequest request);

    /**
     * åˆ é™¤èŠå¤©å®¤
     * @param roomId èŠå¤©å®¤ID
     * @param userId æ“ä½œè€…ID
     */
    void deleteRoom(String roomId, String userId);

    /**
     * è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
     * @param roomId èŠå¤©å®¤ID
     * @return åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
     */
    List&lt;OnlineUserDTO&gt; getOnlineUsers(String roomId);

    /**
     * æœç´¢æ¶ˆæ¯
     * @param roomId èŠå¤©å®¤ID
     * @param keyword å…³é”®è¯
     * @return åŒ¹é…çš„æ¶ˆæ¯åˆ—è¡¨
     */
    List&lt;MessageDTO&gt; searchMessages(String roomId, String keyword);

    /**
     * æ ‡è®°æ¶ˆæ¯å·²è¯»
     * @param roomId èŠå¤©å®¤ID
     * @param userId ç”¨æˆ·ID
     */
    void markMessagesAsRead(String roomId, String userId);
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">2.2 ChatServiceImplæ ¸å¿ƒå®ç°ï¼ˆéƒ¨åˆ†ï¼‰</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatServiceImpl.java</div>
                        <div class="text-xs text-gray-400">èŠå¤©æœåŠ¡å®ç°</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.service.impl;

import com.example.chatbot.dto.*;
import com.example.chatbot.entity.ChatRoom;
import com.example.chatbot.entity.Message;
import com.example.chatbot.repository.ChatRoomRepository;
import com.example.chatbot.repository.MessageRepository;
import com.example.chatbot.service.ChatService;
import com.example.chatbot.service.OnlineUserService;
import com.example.chatbot.service.ai.ChatAgent;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

/**
 * èŠå¤©æœåŠ¡å®ç°ç±»
 * å®ç°æ‰€æœ‰èŠå¤©ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class ChatServiceImpl implements ChatService {

    private final ChatRoomRepository chatRoomRepository;
    private final MessageRepository messageRepository;
    private final OnlineUserService onlineUserService;
    private final ChatAgent chatAgent;
    private final SimpMessagingTemplate messagingTemplate;

    @Override
    @Transactional
    public ChatRoomDTO createRoom(CreateRoomRequest request) {
        log.info("åˆ›å»ºèŠå¤©å®¤: {}", request.getName());

        String roomId = generateRoomId();

        ChatRoom room = ChatRoom.builder()
            .roomId(roomId)
            .name(request.getName())
            .description(request.getDescription())
            .type(request.getType() != null ? request.getType() : ChatRoom.RoomType.GROUP)
            .createdBy(request.getCreatorId())
            .createdByName(request.getCreatorName())
            .maxMembers(request.getMaxMembers())
            .aiEnabled(request.getAiEnabled() != null ? request.getAiEnabled() : true)
            .aiBotName(request.getAiBotName() != null ? request.getAiBotName() : "AIåŠ©æ‰‹")
            .ragEnabled(request.getRagEnabled() != null ? request.getRagEnabled() : false)
            .knowledgeBaseId(request.getKnowledgeBaseId())
            .build();

        room.addMember(request.getCreatorId());
        chatRoomRepository.save(room);

        log.info("èŠå¤©å®¤åˆ›å»ºæˆåŠŸ: {}", roomId);
        return mapToRoomDTO(room);
    }

    @Override
    @Transactional
    public void joinRoom(String roomId, String userId, String userName) {
        log.info("ç”¨æˆ· {} åŠ å…¥èŠå¤©å®¤ {}", userName, roomId);

        ChatRoom room = chatRoomRepository.findByRoomId(roomId)
            .orElseThrow(() -> new IllegalArgumentException("èŠå¤©å®¤ä¸å­˜åœ¨"));

        room.addMember(userId);
        room.setLastActiveAt(java.time.LocalDateTime.now());
        chatRoomRepository.save(room);

        // åœ¨çº¿ç”¨æˆ·ç®¡ç†
        onlineUserService.addUser(roomId, userId, userName);

        // å‘é€åŠ å…¥ç³»ç»Ÿæ¶ˆæ¯
        Message joinMessage = Message.builder()
            .roomId(roomId)
            .senderId("SYSTEM")
            .senderName("ç³»ç»Ÿ")
            .content(userName + " åŠ å…¥äº†èŠå¤©å®¤")
            .type(Message.MessageType.JOIN)
            .isAiGenerated(false)
            .build();
        messageRepository.save(joinMessage);

        // å¹¿æ’­åŠ å…¥æ¶ˆæ¯ç»™èŠå¤©å®¤æ‰€æœ‰ç”¨æˆ·
        messagingTemplate.convertAndSend(
            "/topic/room/" + roomId,
            mapToMessageDTO(joinMessage)
        );

        // å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
        broadcastOnlineUsers(roomId);
    }

    @Override
    @Transactional
    public void leaveRoom(String roomId, String userId) {
        log.info("ç”¨æˆ· {} ç¦»å¼€èŠå¤©å®¤ {}", userId, roomId);

        ChatRoom room = chatRoomRepository.findByRoomId(roomId)
            .orElseThrow(() -> new IllegalArgumentException("èŠå¤©å®¤ä¸å­˜åœ¨"));

        room.removeMember(userId);
        room.setLastActiveAt(java.time.LocalDateTime.now());
        chatRoomRepository.save(room);

        // ç§»é™¤åœ¨çº¿ç”¨æˆ·
        String userName = onlineUserService.removeUser(roomId, userId);

        // å‘é€ç¦»å¼€ç³»ç»Ÿæ¶ˆæ¯
        Message leaveMessage = Message.builder()
            .roomId(roomId)
            .senderId("SYSTEM")
            .senderName("ç³»ç»Ÿ")
            .content(userName + " ç¦»å¼€äº†èŠå¤©å®¤")
            .type(Message.MessageType.LEAVE)
            .isAiGenerated(false)
            .build();
        messageRepository.save(leaveMessage);

        // å¹¿æ’­ç¦»å¼€æ¶ˆæ¯
        messagingTemplate.convertAndSend(
            "/topic/room/" + roomId,
            mapToMessageDTO(leaveMessage)
        );

        // å¹¿æ’­æ›´æ–°åçš„åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
        broadcastOnlineUsers(roomId);
    }

    @Override
    @Transactional
    public MessageDTO sendMessage(SendMessageRequest request) {
        log.info("å‘é€æ¶ˆæ¯åˆ°èŠå¤©å®¤ {}: {}", request.getRoomId(), request.getContent());

        ChatRoom room = chatRoomRepository.findByRoomId(request.getRoomId())
            .orElseThrow(() -> new IllegalArgumentException("èŠå¤©å®¤ä¸å­˜åœ¨"));

        // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
        Message userMessage = Message.builder()
            .roomId(request.getRoomId())
            .senderId(request.getSenderId())
            .senderName(request.getSenderName())
            .content(request.getContent())
            .type(request.getType() != null ? request.getType() : Message.MessageType.TEXT)
            .isAiGenerated(false)
            .build();
        messageRepository.save(userMessage);

        // æ›´æ–°èŠå¤©å®¤æœ€åæ´»è·ƒæ—¶é—´
        room.setLastActiveAt(java.time.LocalDateTime.now());
        chatRoomRepository.save(room);

        // å¹¿æ’­ç”¨æˆ·æ¶ˆæ¯
        messagingTemplate.convertAndSend(
            "/topic/room/" + request.getRoomId(),
            mapToMessageDTO(userMessage)
        );

        // å¦‚æœå¯ç”¨äº†AIåŠ©æ‰‹ï¼Œç”ŸæˆAIå›å¤
        if (room.getAiEnabled()) {
            handleAiResponse(request.getRoomId(), room, userMessage);
        }

        return mapToMessageDTO(userMessage);
    }

    /**
     * å¤„ç†AIå“åº”ï¼ˆå¼‚æ­¥ï¼‰
     */
    private void handleAiResponse(String roomId, ChatRoom room, Message userMessage) {
        new Thread(() -&gt; {
            try {
                // å‘é€"AIæ­£åœ¨è¾“å…¥"çŠ¶æ€
                sendTypingStatus(roomId, room.getAiBotName());

                // è°ƒç”¨ChatAgentç”Ÿæˆå›å¤
                String aiResponse = chatAgent.generateResponse(
                    room.getRoomId(),
                    room.getAiBotName(),
                    userMessage.getContent(),
                    room.getRagEnabled(),
                    room.getKnowledgeBaseId()
                );

                // ä¿å­˜AIå›å¤
                Message aiMessage = Message.builder()
                    .roomId(roomId)
                    .senderId("AI")
                    .senderName(room.getAiBotName())
                    .content(aiResponse)
                    .type(Message.MessageType.TEXT)
                    .isAiGenerated(true)
                    .aiModel("gpt-4")
                    .build();
                messageRepository.save(aiMessage);

                // å¹¿æ’­AIå›å¤
                messagingTemplate.convertAndSend(
                    "/topic/room/" + roomId,
                    mapToMessageDTO(aiMessage)
                );

            } catch (Exception e) {
                log.error("AIå“åº”ç”Ÿæˆå¤±è´¥", e);
            }
        }).start();
    }

    /**
     * å‘é€è¾“å…¥çŠ¶æ€
     */
    private void sendTypingStatus(String roomId, String userName) {
        Message typingMessage = Message.builder()
            .roomId(roomId)
            .senderId(userName)
            .senderName(userName)
            .content("æ­£åœ¨è¾“å…¥...")
            .type(Message.MessageType.TYPING)
            .isAiGenerated(false)
            .build();
        messagingTemplate.convertAndSend(
            "/topic/room/" + roomId,
            mapToMessageDTO(typingMessage)
        );
    }

    /**
     * å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
     */
    private void broadcastOnlineUsers(String roomId) {
        List&lt;OnlineUserDTO&gt; onlineUsers = onlineUserService.getOnlineUsers(roomId);
        messagingTemplate.convertAndSend(
            "/topic/room/" + roomId + "/online",
            onlineUsers
        );
    }

    @Override
    public Page&lt;MessageDTO&gt; getRoomMessages(String roomId, int page, int size) {
        Pageable pageable = PageRequest.of(page, size);
        Page&lt;Message&gt; messages = messageRepository.findByRoomIdOrderByCreatedAtAsc(roomId, pageable);
        return messages.map(this::mapToMessageDTO);
    }

    @Override
    public List&lt;ChatRoomDTO&gt; getUserRooms(String userId) {
        // ç®€åŒ–å®ç°ï¼šæŸ¥è¯¢ç”¨æˆ·å‚ä¸çš„æ‰€æœ‰èŠå¤©å®¤
        return chatRoomRepository.findAll().stream()
            .filter(room -&gt; room.getMemberIds().contains(userId))
            .map(this::mapToRoomDTO)
            .collect(Collectors.toList());
    }

    @Override
    @Transactional
    public void deleteRoom(String roomId, String userId) {
        ChatRoom room = chatRoomRepository.findByRoomId(roomId)
            .orElseThrow(() -&gt; new IllegalArgumentException("èŠå¤©å®¤ä¸å­˜åœ¨"));

        if (!room.getCreatedBy().equals(userId)) {
            throw new IllegalArgumentException("åªæœ‰åˆ›å»ºè€…æ‰èƒ½åˆ é™¤èŠå¤©å®¤");
        }

        // åˆ é™¤æ‰€æœ‰æ¶ˆæ¯
        messageRepository.deleteByRoomId(roomId);
        // åˆ é™¤èŠå¤©å®¤
        chatRoomRepository.delete(room);
    }

    @Override
    public List&lt;OnlineUserDTO&gt; getOnlineUsers(String roomId) {
        return onlineUserService.getOnlineUsers(roomId);
    }

    @Override
    public List&lt;MessageDTO&gt; searchMessages(String roomId, String keyword) {
        List&lt;Message&gt; messages = messageRepository.searchByKeyword(roomId, keyword);
        return messages.stream()
            .map(this::mapToMessageDTO)
            .collect(Collectors.toList());
    }

    @Override
    @Transactional
    public void markMessagesAsRead(String roomId, String userId) {
        log.info("æ ‡è®°ç”¨æˆ· {} åœ¨èŠå¤©å®¤ {} çš„æ¶ˆæ¯ä¸ºå·²è¯»", userId, roomId);
    }

    // è¾…åŠ©æ–¹æ³•
    private String generateRoomId() {
        return "ROOM-" + UUID.randomUUID().toString().substring(0, 8).toUpperCase();
    }

    private MessageDTO mapToMessageDTO(Message message) {
        return MessageDTO.builder()
            .id(message.getId())
            .roomId(message.getRoomId())
            .senderId(message.getSenderId())
            .senderName(message.getSenderName())
            .content(message.getContent())
            .type(message.getType())
            .isAiGenerated(message.getIsAiGenerated())
            .aiModel(message.getAiModel())
            .createdAt(message.getCreatedAt())
            .build();
    }

    private ChatRoomDTO mapToRoomDTO(ChatRoom room) {
        return ChatRoomDTO.builder()
            .roomId(room.getRoomId())
            .name(room.getName())
            .description(room.getDescription())
            .type(room.getType())
            .createdBy(room.getCreatedBy())
            .createdByName(room.getCreatedByName())
            .memberCount(room.getMemberCount())
            .maxMembers(room.getMaxMembers())
            .aiEnabled(room.getAiEnabled())
            .aiBotName(room.getAiBotName())
            .ragEnabled(room.getRagEnabled())
            .knowledgeBaseId(room.getKnowledgeBaseId())
            .createdAt(room.getCreatedAt())
            .lastActiveAt(room.getLastActiveAt())
            .build();
    }
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">3</span>
                    Reactå‰ç«¯å®ç°
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">3.1 ChatPageä¸»ç»„ä»¶</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatPage.tsx</div>
                        <div class="text-xs text-gray-400">Reactä¸»é¡µé¢</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-typescript">import React, { useState, useEffect, useRef } from 'react';
import { SockJS } from 'sockjs-client';
import { Stomp, CompatClient, StompSubscription } from '@stomp/stompjs';
import axios from 'axios';
import { Message, ChatRoom, OnlineUser } from '../types';

interface ChatPageProps {
  userId: string;
  userName: string;
}

/**
 * èŠå¤©é¡µé¢ä¸»ç»„ä»¶
 */
const ChatPage: React.FC&lt;ChatPageProps&gt; = ({ userId, userName }) =&gt; {
  // WebSocketè¿æ¥çŠ¶æ€
  const [stompClient, setStompClient] = useState&lt;CompatClient | null&gt;(null);
  const [connected, setConnected] = useState&lt;boolean&gt;(false);
  const [currentRoom, setCurrentRoom] = useState&lt;ChatRoom | null&gt;(null);

  // æ¶ˆæ¯çŠ¶æ€
  const [messages, setMessages] = useState&lt;Message[]&gt;([]);
  const [newMessage, setNewMessage] = useState&lt;string&gt;('');
  const [onlineUsers, setOnlineUsers] = useState&lt;OnlineUser[]&gt;([]);

  // UIçŠ¶æ€
  const [showRoomList, setShowRoomList] = useState&lt;boolean&gt;(true);
  const [showOnlineUsers, setShowOnlineUsers] = useState&lt;boolean&gt;(true);

  // å¼•ç”¨
  const messagesEndRef = useRef&lt;HTMLDivElement&gt;(null);
  const messageInputRef = useRef&lt;HTMLTextAreaElement&gt;(null);

  // åˆå§‹åŒ–WebSocketè¿æ¥
  useEffect(() =&gt; {
    const client = Stomp.over(() =&gt; {
      return new SockJS('http://localhost:8080/ws-chat');
    });

    client.connect({}, () =&gt; {
      console.log('WebSocketè¿æ¥æˆåŠŸ');
      setConnected(true);
      setStompClient(client);
    }, (error: any) =&gt; {
      console.error('WebSocketè¿æ¥å¤±è´¥:', error);
      setConnected(false);
    });

    return () =&gt; {
      if (client) {
        client.disconnect();
      }
    };
  }, []);

  // æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() =&gt; {
    scrollToBottom();
  }, [messages]);

  const scrollToBottom = () =&gt; {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  // å‘é€æ¶ˆæ¯
  const sendMessage = () =&gt; {
    if (!newMessage.trim() || !stompClient || !currentRoom) {
      return;
    }

    const message: Message = {
      roomId: currentRoom.roomId,
      senderId: userId,
      senderName: userName,
      content: newMessage,
      type: 'TEXT',
      createdAt: new Date(),
    };

    stompClient.send(
      '/app/chat/send',
      {},
      JSON.stringify(message)
    );

    setNewMessage('');
  };

  // åŠ å…¥èŠå¤©å®¤
  const joinRoom = (roomId: string) =&gt; {
    if (!stompClient) return;

    // è®¢é˜…èŠå¤©å®¤æ¶ˆæ¯
    const subscription: StompSubscription = stompClient.subscribe(
      `/topic/room/${roomId}`,
      (message: any) =&gt; {
        const newMsg: Message = JSON.parse(message.body);
        setMessages((prev) =&gt; [...prev, newMsg]);
      }
    );

    // è®¢é˜…åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
    const onlineSubscription: StompSubscription = stompClient.subscribe(
      `/topic/room/${roomId}/online`,
      (message: any) =&gt; {
        const users: OnlineUser[] = JSON.parse(message.body);
        setOnlineUsers(users);
      }
    );

    // å‘é€åŠ å…¥è¯·æ±‚
    stompClient.send(
      '/app/chat/join',
      {},
      JSON.stringify({ roomId, userId, userName })
    );

    // åŠ è½½å†å²æ¶ˆæ¯
    loadHistoryMessages(roomId);
  };

  // åŠ è½½å†å²æ¶ˆæ¯
  const loadHistoryMessages = async (roomId: string) =&gt; {
    try {
      const response = await axios.get(`/api/chat/rooms/${roomId}/messages?page=0&amp;size=50`);
      setMessages(response.data.content);
    } catch (error) {
      console.error('åŠ è½½å†å²æ¶ˆæ¯å¤±è´¥:', error);
    }
  };

  // å¤„ç†å›è½¦å‘é€
  const handleKeyPress = (e: React.KeyboardEvent) =&gt; {
    if (e.key === 'Enter' &amp;&amp; !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };

  return (
    &lt;div className="flex h-screen bg-gray-100"&gt;
      {/* å·¦ä¾§è¾¹æ  - èŠå¤©å®¤åˆ—è¡¨ */}
      {showRoomList &amp;&amp; (
        &lt;aside className="w-80 bg-white border-r border-gray-200 flex flex-col"&gt;
          &lt;div className="p-4 border-b border-gray-200"&gt;
            &lt;h2 className="text-xl font-bold text-gray-900"&gt;èŠå¤©å®¤åˆ—è¡¨&lt;/h2&gt;
          &lt;/div&gt;
          &lt;div className="flex-1 overflow-y-auto"&gt;
            {currentRoom ? (
              &lt;div className="p-4 bg-indigo-50 border-l-4 border-indigo-600"&gt;
                &lt;div className="font-semibold text-gray-900"&gt;{currentRoom.name}&lt;/div&gt;
                &lt;div className="text-sm text-gray-600"&gt;{currentRoom.description}&lt;/div&gt;
              &lt;/div&gt;
            ) : (
              &lt;div className="p-4 text-center text-gray-500"&gt;
                æš‚æ— èŠå¤©å®¤
              &lt;/div&gt;
            )}
          &lt;/div&gt;
          &lt;div className="p-4 border-t border-gray-200"&gt;
            &lt;button className="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg"&gt;
              + åˆ›å»ºèŠå¤©å®¤
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/aside&gt;
      )}

      {/* ä¸­é—´ - èŠå¤©åŒºåŸŸ */}
      &lt;main className="flex-1 flex flex-col"&gt;
        {/* èŠå¤©å®¤å¤´éƒ¨ */}
        &lt;header className="bg-white border-b border-gray-200 p-4 flex items-center justify-between"&gt;
          &lt;div&gt;
            &lt;h1 className="text-xl font-bold text-gray-900"&gt;
              {currentRoom?.name || 'é€‰æ‹©èŠå¤©å®¤'}
            &lt;/h1&gt;
            {currentRoom?.aiEnabled &amp;&amp; (
              &lt;span className="text-sm text-green-600"&gt;ğŸ¤– AIåŠ©æ‰‹å·²å¯ç”¨&lt;/span&gt;
            )}
          &lt;/div&gt;
          &lt;div className="flex items-center gap-2"&gt;
            &lt;button onClick={() =&gt; setShowOnlineUsers(!showOnlineUsers)}&gt;
              ğŸ‘¥ {onlineUsers.length}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/header&gt;

        {/* æ¶ˆæ¯åˆ—è¡¨ */}
        &lt;div className="flex-1 overflow-y-auto p-4 space-y-4"&gt;
          {messages.map((message) =&gt; (
            &lt;MessageItem
              key={message.id}
              message={message}
              isCurrentUser={message.senderId === userId}
            /&gt;
          ))}
          &lt;div ref={messagesEndRef} /&gt;
        &lt;/div&gt;

        {/* è¾“å…¥æ¡† */}
        &lt;div className="bg-white border-t border-gray-200 p-4"&gt;
          &lt;textarea
            ref={messageInputRef}
            value={newMessage}
            onChange={(e) =&gt; setNewMessage(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="è¾“å…¥æ¶ˆæ¯... (Enterå‘é€)"
            className="w-full border border-gray-300 rounded-lg p-3 resize-none"
            rows={3}
          /&gt;
          &lt;div className="flex justify-between items-center mt-2"&gt;
            &lt;div className="flex gap-2"&gt;
              &lt;button className="p-2 hover:bg-gray-100 rounded-lg"&gt;ğŸ˜Š&lt;/button&gt;
              &lt;button className="p-2 hover:bg-gray-100 rounded-lg"&gt;ğŸ“&lt;/button&gt;
            &lt;/div&gt;
            &lt;button
              onClick={sendMessage}
              disabled={!newMessage.trim()}
              className="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50"
            &gt;
              å‘é€
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/main&gt;

      {/* å³ä¾§è¾¹æ  - åœ¨çº¿ç”¨æˆ· */}
      {showOnlineUsers &amp;&amp; (
        &lt;aside className="w-64 bg-white border-l border-gray-200"&gt;
          &lt;div className="p-4 border-b border-gray-200"&gt;
            &lt;h3 className="font-semibold text-gray-900"&gt;åœ¨çº¿ç”¨æˆ·&lt;/h3&gt;
          &lt;/div&gt;
          &lt;div className="p-4 space-y-2"&gt;
            {onlineUsers.map((user) =&gt; (
              &lt;div key={user.userId} className="flex items-center gap-2"&gt;
                &lt;div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm"&gt;
                  {user.userName[0].toUpperCase()}
                &lt;/div&gt;
                &lt;span className="text-sm text-gray-700"&gt;{user.userName}&lt;/span&gt;
              &lt;/div&gt;
            ))}
          &lt;/div&gt;
        &lt;/aside&gt;
      )}
    &lt;/div&gt;
  );
};

/**
 * æ¶ˆæ¯é¡¹ç»„ä»¶
 */
const MessageItem: React.FC&lt;{ message: Message; isCurrentUser: boolean }&gt; = ({
  message,
  isCurrentUser,
}) =&gt; {
  return (
    &lt;div className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'}`}&gt;
      &lt;div
        className={`max-w-[70%] ${
          isCurrentUser ? 'bg-indigo-600 text-white' : 'bg-white text-gray-900'
        } rounded-lg p-3 shadow`}
      &gt;
        {message.isAiGenerated &amp;&amp; (
          &lt;div className="text-xs mb-1 opacity-75"&gt;ğŸ¤– {message.aiModel}&lt;/div&gt;
        )}
        &lt;div className="font-semibold text-sm mb-1"&gt;{message.senderName}&lt;/div&gt;
        &lt;div className="whitespace-pre-wrap"&gt;{message.content}&lt;/div&gt;
        &lt;div className="text-xs mt-1 opacity-75"&gt;
          {new Date(message.createdAt).toLocaleTimeString()}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default ChatPage;
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">4</span>
                    AI Agenté›†æˆ
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">4.1 ChatAgentå®ç°</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatAgent.java</div>
                        <div class="text-xs text-gray-400">å¯¹è¯Agent</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.service.ai;

import com.example.chatbot.repository.MessageRepository;
import dev.langchain4j.model.chat.ChatLanguageModel;
import dev.langchain4j.model.openai.OpenAiChatModel;
import dev.langchain4j.service.AiServices;
import dev.langchain4j.service.SystemMessage;
import dev.langchain4j.service.UserMessage;
import dev.langchain4j.service.spring.AiService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.stream.Collectors;

/**
 * ChatAiServiceæ¥å£
 */
interface ChatAiService {
    @SystemMessage("ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚ç”¨ç®€æ´ã€æœ‰ç”¨çš„æ–¹å¼å›ç­”ç”¨æˆ·é—®é¢˜ã€‚")
    String chat(@UserMessage String userMessage, String conversationContext);
}

/**
 * ChatAgentå®ç°ç±»
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class ChatAgent {

    private final ChatAiService chatAiService;
    private final MessageRepository messageRepository;
    private final RagService ragService;

    public String generateResponse(
        String roomId,
        String botName,
        String userMessage,
        boolean ragEnabled,
        Long knowledgeBaseId
    ) {
        try {
            // 1. æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡
            String conversationContext = buildConversationContext(roomId, 5);

            // 2. å¦‚æœå¯ç”¨RAGï¼Œæ£€ç´¢ç›¸å…³çŸ¥è¯†
            String retrievedContext = "";
            if (ragEnabled &amp;&amp; knowledgeBaseId != null) {
                retrievedContext = ragService.retrieveContext(
                    userMessage,
                    knowledgeBaseId
                );
            }

            // 3. ç»„åˆæœ€ç»ˆæç¤º
            String enhancedMessage = userMessage;
            if (!retrievedContext.isEmpty()) {
                enhancedMessage = String.format(
                    "å‚è€ƒä¿¡æ¯ï¼š\n%s\n\nç”¨æˆ·é—®é¢˜ï¼š%s",
                    retrievedContext,
                    userMessage
                );
            }

            // 4. è°ƒç”¨AIç”Ÿæˆå›å¤
            String response = chatAiService.chat(enhancedMessage, conversationContext);

            log.info("AIå›å¤ç”ŸæˆæˆåŠŸ: roomId={}, length={}", roomId, response.length());
            return response;

        } catch (Exception e) {
            log.error("AIå›å¤ç”Ÿæˆå¤±è´¥", e);
            throw new RuntimeException("AIæš‚æ—¶æ— æ³•å›å¤", e);
        }
    }

    /**
     * æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡
     */
    private String buildConversationContext(String roomId, int limit) {
        try {
            List&lt;Message&gt; recentMessages = messageRepository.findRecentMessages(roomId, limit);
            return recentMessages.stream()
                .map(msg -&gt; String.format("%s: %s", msg.getSenderName(), msg.getContent()))
                .collect(Collectors.joining("\n"));
        } catch (Exception e) {
            log.error("æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡å¤±è´¥", e);
            return "";
        }
    }
}

/**
 * ChatAgenté…ç½®ç±»
 */
@Configuration
class ChatAgentConfig {

    @Value("${openai.api.key}")
    private String apiKey;

    @Value("${openai.model:gpt-4}")
    private String modelName;

    @Bean
    public ChatLanguageModel chatLanguageModel() {
        return OpenAiChatModel.builder()
            .apiKey(apiKey)
            .modelName(modelName)
            .temperature(0.7)
            .maxTokens(1000)
            .build();
    }

    @Bean
    @AiService
    public ChatAiService chatAiService(ChatLanguageModel chatLanguageModel) {
        return AiServices.builder(ChatAiService.class)
            .chatLanguageModel(chatLanguageModel)
            .build();
    }
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">4.2 å¤šBotåè°ƒå™¨</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">MultiBotCoordinator.java</div>
                        <div class="text-xs text-gray-400">å¤šBotåè°ƒ</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.service.ai;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import java.util.*;
import java.util.concurrent.*;

/**
 * å¤šBotåè°ƒå™¨
 */
@Slf4j
@Component
public class MultiBotCoordinator {

    private final Map&lt;String, AIBot&gt; bots = new ConcurrentHashMap&lt;&gt;();
    private final ExecutorService executor = Executors.newFixedThreadPool(5);

    public void registerBot(AIBot bot) {
        bots.put(bot.getBotId(), bot);
        log.info("æ³¨å†ŒBot: {} - {}", bot.getBotId(), bot.getBotName());
    }

    public CompletableFuture&lt;String&gt; dispatchMessage(
        String roomId,
        String userMessage,
        String context
    ) {
        AIBot selectedBot = selectBestBot(userMessage);
        return CompletableFuture.supplyAsync(() -&gt; {
            try {
                return selectedBot.processMessage(userMessage, context);
            } catch (Exception e) {
                log.error("Botå¤„ç†å¤±è´¥: {}", selectedBot.getBotId(), e);
                return "æŠ±æ­‰ï¼Œå¤„ç†æ¶ˆæ¯æ—¶å‡ºç°é”™è¯¯ã€‚";
            }
        }, executor);
    }

    public CompletableFuture&lt;List&lt;BotResponse&gt;&gt; collaborativeProcess(
        String roomId,
        String userMessage,
        Set&lt;String&gt; requiredBots
    ) {
        List&lt;CompletableFuture&lt;BotResponse&gt;&gt; futures = new ArrayList&lt;&gt;();

        for (String botId : requiredBots) {
            AIBot bot = bots.get(botId);
            if (bot != null) {
                futures.add(CompletableFuture.supplyAsync(() -&gt; {
                    String response = bot.processMessage(userMessage, "");
                    return new BotResponse(botId, bot.getBotName(), response);
                }, executor));
            }
        }

        return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
            .thenApply(v -&gt; futures.stream()
                .map(CompletableFuture::join)
                .collect(Collectors.toList())
            );
    }

    private AIBot selectBestBot(String userMessage) {
        return bots.values().stream()
            .filter(bot -&gt; bot.isAvailable())
            .findFirst()
            .orElse(bots.get("default"));
    }

    public List&lt;AIBot&gt; getOnlineBots() {
        return bots.values().stream()
            .filter(AIBot::isAvailable)
            .collect(Collectors.toList());
    }
}

interface AIBot {
    String getBotId();
    String getBotName();
    boolean isAvailable();
    String processMessage(String message, String context);
}

class BotResponse {
    private final String botId;
    private final String botName;
    private final String response;

    public BotResponse(String botId, String botName, String response) {
        this.botId = botId;
        this.botName = botName;
        this.response = response;
    }

    public String getBotId() { return botId; }
    public String getBotName() { return botName; }
    public String getResponse() { return response; }
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">5</span>
                    éƒ¨ç½²å’Œé…ç½®
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">5.1 application.ymlé…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">application.yml</div>
                        <div class="text-xs text-gray-400">åº”ç”¨é…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-yaml">spring:
  application:
    name: langchain4j-chatbot

  # æ•°æ®åº“é…ç½®
  datasource:
    url: jdbc:postgresql://localhost:5432/chatbot_db
    username: postgres
    password: your_password
    driver-class-name: org.postgresql.Driver

  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  # Redisé…ç½®ï¼ˆåœ¨çº¿çŠ¶æ€ç®¡ç†ï¼‰
  data:
    redis:
      host: localhost
      port: 6379
      password:
      database: 0
      timeout: 5000ms

# æœåŠ¡å™¨é…ç½®
server:
  port: 8080

# OpenAIé…ç½®
openai:
  api:
    key: ${OPENAI_API_KEY:your-openai-api-key}
    base-url: https://api.openai.com/v1
  model: gpt-4
  temperature: 0.7
  max-tokens: 1000

# æ—¥å¿—é…ç½®
logging:
  level:
    com.example.chatbot: DEBUG
    dev.langchain4j: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# WebSocketé…ç½®
websocket:
  allowed-origins: "*"
  heartbeat:
    enabled: true
    interval: 30000
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">5.2 Dockeréƒ¨ç½²é…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">docker-compose.yml</div>
                        <div class="text-xs text-gray-400">å®¹å™¨ç¼–æ’</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-yaml">version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15
    container_name: chatbot-postgres
    environment:
      POSTGRES_DB: chatbot_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: your_password
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - chatbot-network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: chatbot-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    networks:
      - chatbot-network

  # Spring Bootåº”ç”¨
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: chatbot-app
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/chatbot_db
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: your_password
      SPRING_DATA_REDIS_HOST: redis
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    depends_on:
      - postgres
      - redis
    networks:
      - chatbot-network

volumes:
  postgres-data:
  redis-data:

networks:
  chatbot-network:
    driver: bridge
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">5.3 Dockerfile</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">Dockerfile</div>
                        <div class="text-xs text-gray-400">é•œåƒæ„å»º</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-dockerfile"># å¤šé˜¶æ®µæ„å»º - æ„å»ºé˜¶æ®µ
FROM maven:3.9-eclipse-temurin-17 AS builder

WORKDIR /app

# å¤åˆ¶pom.xmlå¹¶ä¸‹è½½ä¾èµ–ï¼ˆåˆ©ç”¨Dockerç¼“å­˜ï¼‰
COPY pom.xml .
RUN mvn dependency:go-offline

# å¤åˆ¶æºä»£ç å¹¶æ„å»º
COPY src ./src
RUN mvn clean package -DskipTests

# è¿è¡Œé˜¶æ®µ
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# å®‰è£…å¿…è¦çš„å·¥å…·
RUN apk add --no-cache tzdata

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶jaråŒ…
COPY --from=builder /app/target/*.jar app.jar

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -S appgroup &amp;&amp; adduser -S appuser -G appgroup
USER appuser

# æš´éœ²ç«¯å£
EXPOSE 8080

# JVMä¼˜åŒ–å‚æ•°
ENV JAVA_OPTS="-Xms512m -Xmx1g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:8080/actuator/health || exit 1

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">6</span>
                    æœ€ä½³å®è·µå’Œæµ‹è¯•
                </h2>

                <div class="bg-blue-50 border border-blue-100 rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="text-blue-600">ğŸ’¡</span> WebSocketæ€§èƒ½ä¼˜åŒ–
                    </h3>
                    <ul class="text-gray-700 space-y-3 text-sm">
                        <li>â€¢ <strong>è¿æ¥æ± ç®¡ç†</strong>ï¼šä½¿ç”¨è¿æ¥æ± é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯è¿æ¥</li>
                        <li>â€¢ <strong>å¿ƒè·³æ£€æµ‹</strong>ï¼šå®šæœŸå‘é€å¿ƒè·³åŒ…ä¿æŒè¿æ¥æ´»è·ƒ</li>
                        <li>â€¢ <strong>æ¶ˆæ¯å‹ç¼©</strong>ï¼šå¯¹å¤§æ¶ˆæ¯å¯ç”¨GZIPå‹ç¼©å‡å°‘ä¼ è¾“é‡</li>
                        <li>â€¢ <strong>æ–­çº¿é‡è¿</strong>ï¼šå®ç°è‡ªåŠ¨é‡è¿æœºåˆ¶æå‡ç”¨æˆ·ä½“éªŒ</li>
                        <li>â€¢ <strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²</li>
                    </ul>
                </div>

                <div class="bg-green-50 border border-green-100 rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="text-green-600">âœ…</span> æ¶ˆæ¯æŒä¹…åŒ–ç­–ç•¥
                    </h3>
                    <ul class="text-gray-700 space-y-3 text-sm">
                        <li>â€¢ <strong>æ‰¹é‡æ’å…¥</strong>ï¼šä½¿ç”¨JPAçš„saveAllæ‰¹é‡æ’å…¥æå‡æ€§èƒ½</li>
                        <li>â€¢ <strong>å¼‚æ­¥æŒä¹…åŒ–</strong>ï¼šå…ˆå¹¿æ’­æ¶ˆæ¯å†å¼‚æ­¥ä¿å­˜ï¼Œå‡å°‘å»¶è¿Ÿ</li>
                        <li>â€¢ <strong>åˆ†é¡µæŸ¥è¯¢</strong>ï¼šå†å²æ¶ˆæ¯ä½¿ç”¨åˆ†é¡µé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šæ•°æ®</li>
                        <li>â€¢ <strong>æ¶ˆæ¯æ¸…ç†</strong>ï¼šå®šæœŸæ¸…ç†è¿‡æœŸå†å²æ¶ˆæ¯é‡Šæ”¾å­˜å‚¨ç©ºé—´</li>
                        <li>â€¢ <strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºåˆé€‚çš„ç´¢å¼•</li>
                    </ul>
                </div>

                <div class="bg-amber-50 border border-amber-100 rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="text-amber-600">âš ï¸</span> å®‰å…¨æ³¨æ„äº‹é¡¹
                    </h3>
                    <ul class="text-gray-700 space-y-3 text-sm">
                        <li>â€¢ <strong>CSRFé˜²æŠ¤</strong>ï¼šå¯ç”¨Spring Securityçš„CSRFé˜²æŠ¤</li>
                        <li>â€¢ <strong>CORSé…ç½®</strong>ï¼šé™åˆ¶å…è®¸çš„è·¨åŸŸæ¥æº</li>
                        <li>â€¢ <strong>æ¶ˆæ¯è¿‡æ»¤</strong>ï¼šè¿‡æ»¤æ•æ„Ÿè¯æ±‡å’Œæ¶æ„å†…å®¹</li>
                        <li>â€¢ <strong>é€Ÿç‡é™åˆ¶</strong>ï¼šé™åˆ¶ç”¨æˆ·å‘é€æ¶ˆæ¯é¢‘ç‡</li>
                        <li>â€¢ <strong>å†…å®¹å®¡æ ¸</strong>ï¼šé›†æˆå†…å®¹å®¡æ ¸æœåŠ¡è¿‡æ»¤ä¸å½“å†…å®¹</li>
                    </ul>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">6.1 å•å…ƒæµ‹è¯•ç¤ºä¾‹</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatServiceTest.java</div>
                        <div class="text-xs text-gray-400">å•å…ƒæµ‹è¯•</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.chatbot.service;

import com.example.chatbot.dto.*;
import com.example.chatbot.entity.ChatRoom;
import com.example.chatbot.entity.Message;
import com.example.chatbot.repository.ChatRoomRepository;
import com.example.chatbot.repository.MessageRepository;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;

import java.util.Arrays;
import java.util.List;
import java.util.Optional;
import java.util.HashSet;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.*;
import static org.mockito.Mockito.*;

/**
 * ChatServiceå•å…ƒæµ‹è¯•
 */
@ExtendWith(MockitoExtension.class)
class ChatServiceTest {

    @Mock
    private ChatRoomRepository chatRoomRepository;

    @Mock
    private MessageRepository messageRepository;

    @Mock
    private OnlineUserService onlineUserService;

    @Mock
    private ChatAgent chatAgent;

    @Mock
    private SimpMessagingTemplate messagingTemplate;

    @InjectMocks
    private ChatServiceImpl chatService;

    @Test
    void testCreateRoom() {
        CreateRoomRequest request = CreateRoomRequest.builder()
            .name("æµ‹è¯•èŠå¤©å®¤")
            .creatorId("user123")
            .creatorName("æµ‹è¯•ç”¨æˆ·")
            .build();

        when(chatRoomRepository.save(any(ChatRoom.class)))
            .thenAnswer(invocation -&gt; invocation.getArgument(0));

        ChatRoomDTO result = chatService.createRoom(request);

        assertNotNull(result);
        assertEquals("æµ‹è¯•èŠå¤©å®¤", result.getName());
        assertEquals("user123", result.getCreatedBy());
        verify(chatRoomRepository, times(1)).save(any(ChatRoom.class));
    }

    @Test
    void testJoinRoom() {
        String roomId = "ROOM-123";
        String userId = "user456";
        String userName = "æ–°ç”¨æˆ·";

        ChatRoom room = ChatRoom.builder()
            .roomId(roomId)
            .name("æµ‹è¯•èŠå¤©å®¤")
            .memberIds(new HashSet&lt;&gt;())
            .build();

        when(chatRoomRepository.findByRoomId(roomId))
            .thenReturn(Optional.of(room));
        when(chatRoomRepository.save(any(ChatRoom.class)))
            .thenAnswer(invocation -&gt; invocation.getArgument(0));
        when(messageRepository.save(any(Message.class)))
            .thenAnswer(invocation -&gt; invocation.getArgument(0));

        chatService.joinRoom(roomId, userId, userName);

        assertTrue(room.isMember(userId));
        verify(onlineUserService, times(1)).addUser(roomId, userId, userName);
        verify(messageRepository, times(1)).save(any(Message.class));
        verify(messagingTemplate, times(1)).convertAndSend(
            eq("/topic/room/" + roomId),
            any(MessageDTO.class)
        );
    }

    @Test
    void testGetRoomMessages() {
        String roomId = "ROOM-123";
        Message message1 = Message.builder()
            .id(1L)
            .roomId(roomId)
            .senderId("user1")
            .senderName("ç”¨æˆ·1")
            .content("æ¶ˆæ¯1")
            .build();
        Message message2 = Message.builder()
            .id(2L)
            .roomId(roomId)
            .senderId("user2")
            .senderName("ç”¨æˆ·2")
            .content("æ¶ˆæ¯2")
            .build();

        Page&lt;Message&gt; messagePage = new PageImpl&lt;&gt;(
            Arrays.asList(message1, message2),
            PageRequest.of(0, 10),
            2
        );

        when(messageRepository.findByRoomIdOrderByCreatedAtAsc(
            eq(roomId), any(Pageable.class)
        )).thenReturn(messagePage);

        Page&lt;MessageDTO&gt; result = chatService.getRoomMessages(roomId, 0, 10);

        assertEquals(2, result.getTotalElements());
        assertEquals("æ¶ˆæ¯1", result.getContent().get(0).getContent());
        assertEquals("æ¶ˆæ¯2", result.getContent().get(1).getContent());
    }

    @Test
    void testDeleteRoom_Success() {
        String roomId = "ROOM-123";
        String creatorId = "user123";

        ChatRoom room = ChatRoom.builder()
            .roomId(roomId)
            .name("æµ‹è¯•èŠå¤©å®¤")
            .createdBy(creatorId)
            .build();

        when(chatRoomRepository.findByRoomId(roomId))
            .thenReturn(Optional.of(room));

        chatService.deleteRoom(roomId, creatorId);

        verify(messageRepository, times(1)).deleteByRoomId(roomId);
        verify(chatRoomRepository, times(1)).delete(room);
    }

    @Test
    void testDeleteRoom_NotCreator() {
        String roomId = "ROOM-123";
        String otherUserId = "otheruser";

        ChatRoom room = ChatRoom.builder()
            .roomId(roomId)
            .name("æµ‹è¯•èŠå¤©å®¤")
            .createdBy("user123")
            .build();

        when(chatRoomRepository.findByRoomId(roomId))
            .thenReturn(Optional.of(room));

        assertThrows(IllegalArgumentException.class,
            () -&gt; chatService.deleteRoom(roomId, otherUserId));
        verify(chatRoomRepository, never()).delete(any());
    }
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg p-8 text-white">
                    <h2 class="text-2xl font-bold mb-4">ğŸ¯ é¡¹ç›®æ€»ç»“</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸ”Œ æ ¸å¿ƒæŠ€æœ¯</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ WebSocketå®æ—¶åŒå‘é€šä¿¡</li>
                                <li>â€¢ STOMPæ¶ˆæ¯åè®®</li>
                                <li>â€¢ Spring Boot 3.2.x</li>
                                <li>â€¢ React 18 + TypeScript</li>
                                <li>â€¢ PostgreSQL + Redis</li>
                                <li>â€¢ LangChain4j AIé›†æˆ</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">âœ¨ å…³é”®åŠŸèƒ½</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ å¤šç”¨æˆ·å®æ—¶ç¾¤èŠ</li>
                                <li>â€¢ æ¶ˆæ¯æŒä¹…åŒ–å’Œå†å²è®°å½•</li>
                                <li>â€¢ åœ¨çº¿ç”¨æˆ·çŠ¶æ€ç®¡ç†</li>
                                <li>â€¢ AIæ™ºèƒ½å¯¹è¯åŠ©æ‰‹</li>
                                <li>â€¢ RAGçŸ¥è¯†åº“é›†æˆ</li>
                                <li>â€¢ å¤šBotåä½œ</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸš€ æœ€ä½³å®è·µ</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ å¼‚æ­¥æ¶ˆæ¯å¤„ç†</li>
                                <li>â€¢ æ‰¹é‡æ•°æ®åº“æ“ä½œ</li>
                                <li>â€¢ åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–</li>
                                <li>â€¢ Dockerå®¹å™¨åŒ–éƒ¨ç½²</li>
                                <li>â€¢ å¥åº·æ£€æŸ¥å’Œç›‘æ§</li>
                                <li>â€¢ å®‰å…¨é˜²æŠ¤æœºåˆ¶</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <p class="text-lg mb-2">ğŸ“š <strong>ä¸‹ä¸€ç« ï¼šbest-practices.html</strong></p>
                        <p class="text-sm">å­¦ä¹ LangChain4jå¼€å‘çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ä»£ç ç»„ç»‡ã€é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ç­‰</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>
</html>
