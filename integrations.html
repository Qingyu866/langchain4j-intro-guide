<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¡†æ¶é›†æˆ - LangChain4j å­¦ä¹ æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white text-gray-800 antialiased">
    <div class="flex min-h-screen">
        <aside class="w-[280px] fixed h-screen bg-white border-r border-gray-200 overflow-y-auto pb-8">
  <div class="p-6">
    <div class="flex items-center gap-3 mb-8">
      <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
      <div>
        <h1 class="font-bold text-gray-900">LangChain4j</h1>
        <p class="text-xs text-gray-500">å…¥é—¨æŒ‡å—</p>
      </div>
    </div>

    <div class="space-y-6">
      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">å¿«é€Ÿå¼€å§‹</h3>
        <ul class="space-y-1">
          <li><a href="index.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="index">æ¦‚è§ˆ</a></li>
          <li><a href="getting-started.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="getting-started">ç¯å¢ƒå‡†å¤‡</a></li>
          <li><a href="core-concepts.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="core-concepts">æ ¸å¿ƒæ¦‚å¿µ</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">æ ¸å¿ƒåŠŸèƒ½</h3>
        <ul class="space-y-1">
          <li><a href="embedding-models.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="embedding-models">Embedding æ¨¡å‹</a></li>
          <li><a href="prompt-templates.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="prompt-templates">Prompt æ¨¡æ¿</a></li>
          <li><a href="output-parsers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="output-parsers">è¾“å‡ºè§£æ</a></li>
          <li><a href="model-providers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="model-providers">æ¨¡å‹æä¾›å•†</a></li>
          <li><a href="function-calling.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="function-calling">å‡½æ•°è°ƒç”¨</a></li>
          <li><a href="advanced-features.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="advanced-features">é«˜çº§ç‰¹æ€§</a></li>
          <li><a href="multimodal.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="multimodal">å¤šæ¨¡æ€</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">RAG å®Œæ•´æŒ‡å—</h3>
        <ul class="space-y-1">
          <li><a href="rag-intro.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-intro">RAG ç®€ä»‹</a></li>
          <li><a href="rag-setup.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-setup">RAG ç¯å¢ƒæ­å»º</a></li>
          <li><a href="rag-implementation.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-implementation">RAG å®ç°</a></li>
          <li><a href="rag-advanced.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="rag-advanced">RAG é«˜çº§</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">é¡¹ç›®å®æˆ˜</h3>
        <ul class="space-y-1">
          <li><a href="practice.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="practice">ç»¼åˆå®æˆ˜</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">æœ€ä½³å®è·µ</h3>
        <ul class="space-y-1">
          <li><a href="best-practices.html" data-page="best\-practices" class="nav-link bg-indigo-50 text-indigo-700 font-medium block px-4 py-2\.5 rounded-md transition-all text-center">æœ€ä½³å®è·µ</a></li>
          <li><a href="testing.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="testing">æµ‹è¯•ç­–ç•¥</a></li>
          <li><a href="performance.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="performance">æ€§èƒ½ä¼˜åŒ–</a></li>
          <li><a href="deep-dive.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="deep-dive">æ·±åº¦è§£æ</a></li>
          <li><a href="error-handling.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="error-handling">é”™è¯¯å¤„ç†</a></li>
          <li><a href="moderation.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="moderation">å†…å®¹å®¡æ ¸</a></li>
          <li><a href="troubleshooting.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="troubleshooting">æ•…éšœæ’æŸ¥</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">é¢è¯•å‡†å¤‡</h3>
        <ul class="space-y-1">
          <li><a href="interview.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="interview">é¢è¯•å‡†å¤‡</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">å…¶ä»–</h3>
        <ul class="space-y-1">
          <li><a href="search.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="search">å‘é‡æœç´¢</a></li>
          <li><a href="chat-listeners.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="chat-listeners">ç›‘å¬å™¨</a></li>
          <li><a href="faq.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="faq">å¸¸è§é—®é¢˜</a></li>
          <li><a href="cost-optimization.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="cost-optimization">æˆæœ¬ä¼˜åŒ–</a></li>
          <li><a href="deployment.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all text-center" data-page="deployment">éƒ¨ç½²ä¸Šçº¿</a></li>
        </ul>
      </div>
    </div>
  </div>
</aside>

        <main class="flex-1 ml-[280px] px-8 py-12 max-w-7xl">
            <div class="mb-8 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-semibold">2025-02-14</span>
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-semibold">æ¡†æ¶é›†æˆ</span>
                    <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold">ä¸­çº§éš¾åº¦</span>
                </div>
            </div>

            <h1 class="text-5xl font-bold text-gray-900 mb-6">LangChain4j æ¡†æ¶é›†æˆ</h1>

            <div class="mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“‹ é›†æˆæ¦‚è§ˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-br from-green-50 to-teal-50 border border-green-100 rounded-xl p-6">
                        <div class="text-3xl mb-3">ğŸƒ</div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Spring Boot</h3>
                        <ul class="text-gray-600 text-sm space-y-1">
                            <li>â€¢ è‡ªåŠ¨é…ç½®</li>
                            <li>â€¢ ä¾èµ–æ³¨å…¥</li>
                            <li>â€¢ AOPæ”¯æŒ</li>
                        </ul>
                    </div>
                    <div class="bg-gradient-to-br from-red-50 to-orange-50 border border-red-100 rounded-xl p-6">
                        <div class="text-3xl mb-3">âš¡</div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Quarkus</h3>
                        <ul class="text-gray-600 text-sm space-y-1">
                            <li>â€¢ CDIé›†æˆ</li>
                            <li>â€¢ åŸç”Ÿé•œåƒ</li>
                            <li>â€¢ å¿«é€Ÿå¯åŠ¨</li>
                        </ul>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-6">
                        <div class="text-3xl mb-3">ğŸ”„</div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">æ¶ˆæ¯é˜Ÿåˆ—</h3>
                        <ul class="text-gray-600 text-sm space-y-1">
                            <li>â€¢ Kafkaé›†æˆ</li>
                            <li>â€¢ RabbitMQ</li>
                            <li>â€¢ å¼‚æ­¥å¤„ç†</li>
                        </ul>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-100 rounded-xl p-6">
                        <div class="text-3xl mb-3">ğŸ’¾</div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">æ•°æ®å­˜å‚¨</h3>
                        <ul class="text-gray-600 text-sm space-y-1">
                            <li>â€¢ PostgreSQL</li>
                            <li>â€¢ Redisç¼“å­˜</li>
                            <li>â€¢ å‘é‡æ•°æ®åº“</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mb-12 bg-blue-50 border border-blue-100 rounded-lg p-6">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">ğŸ’¡</span>
                    <div>
                        <h3 class="font-bold text-gray-900 mb-2">å­¦ä¹ ç›®æ ‡</h3>
                        <ul class="text-gray-700 space-y-2 text-sm">
                            <li>â€¢ æŒæ¡ LangChain4j ä¸ Spring Boot çš„æ·±åº¦é›†æˆ</li>
                            <li>â€¢ å­¦ä¹  Quarkus åŸç”Ÿé›†æˆå’Œä¼˜åŒ–</li>
                            <li>â€¢ ç†è§£æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†æ¨¡å¼</li>
                            <li>â€¢ æŒæ¡ Redis ç¼“å­˜é›†æˆç­–ç•¥</li>
                            <li>â€¢ äº†è§£å‘é‡æ•°æ®åº“æœ€ä½³å®è·µ</li>
                        </ul>
                    </div>
                </div>
            </div>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">1</span>
                    Spring Boot é›†æˆ
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.1 ä¾èµ–é…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">pom.xml</div>
                        <div class="text-xs text-gray-400">Mavenä¾èµ–</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.0&lt;/version&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;langchain4j-spring-boot&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;

    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
        &lt;langchain4j.version&gt;0.36.2&lt;/langchain4j.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!-- Spring Boot Web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Spring Boot Data JPA --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Spring Boot Data Redis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- LangChain4j Spring Boot Starter --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;
            &lt;artifactId&gt;langchain4j-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;${langchain4j.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- LangChain4j OpenAI --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;
            &lt;artifactId&gt;langchain4j-open-ai&lt;/artifactId&gt;
            &lt;version&gt;${langchain4j.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- PostgreSQL Driver --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Lombok --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.2 application.ymlé…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">application.yml</div>
                        <div class="text-xs text-gray-400">åº”ç”¨é…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-yaml">spring:
  application:
    name: langchain4j-app

  # æ•°æ®åº“é…ç½®
  datasource:
    url: jdbc:postgresql://localhost:5432/langchain4j
    username: postgres
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver

  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # Redisé…ç½®
  data:
    redis:
      host: localhost
      port: 6379
      password: ${REDIS_PASSWORD}
      database: 0
      timeout: 5000ms

  # ç¼“å­˜é…ç½®
  cache:
    type: redis
    redis:
      time-to-live: 3600000  # 1å°æ—¶

# LangChain4jé…ç½®
langchain4j:
  # OpenAIé…ç½®
  open-ai:
    chat-model:
      api-key: ${OPENAI_API_KEY}
      model-name: gpt-4
      temperature: 0.7
      max-tokens: 1000
      timeout: 60s
    embedding-model:
      api-key: ${OPENAI_API_KEY}
      model-name: text-embedding-3-small
      dimension: 1536

# æœåŠ¡å™¨é…ç½®
server:
  port: 8080

# æ—¥å¿—é…ç½®
logging:
  level:
    com.example: DEBUG
    dev.langchain4j: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# Actuatorç›‘æ§
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  metrics:
    export:
      prometheus:
        enabled: true
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.3 AIæœåŠ¡ç»„ä»¶</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatService.java</div>
                        <div class="text-xs text-gray-400">Spring Beanå®šä¹‰</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.service;

import dev.langchain4j.service.AiServices;
import dev.langchain4j.service.SystemMessage;
import dev.langchain4j.service.spring.AiService;
import org.springframework.stereotype.Service;

/**
 * èŠå¤©AIæœåŠ¡
 * ä½¿ç”¨@AiServiceæ³¨è§£è‡ªåŠ¨æ³¨å†Œä¸ºSpring Bean
 */
@Service
@AiService
public class ChatService {

    /**
     * ç³»ç»Ÿæ¶ˆæ¯ï¼šå®šä¹‰AIçš„è§’è‰²å’Œè¡Œä¸º
     */
    @SystemMessage("""
        ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚
        ç”¨ç®€æ´ã€æœ‰ç”¨çš„æ–¹å¼å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
        å¦‚æœä¸ç¡®å®šï¼Œè¯šå®åœ°è¯´"æˆ‘ä¸çŸ¥é“"ã€‚
        """)
    
    /**
     * èŠå¤©æ–¹æ³•
     * @param userMessage ç”¨æˆ·æ¶ˆæ¯
     * @return AIå›å¤
     */
    public String chat(String userMessage);
}

/**
 * RAGæœåŠ¡
 * ç»“åˆå‘é‡æœç´¢å’ŒçŸ¥è¯†åº“
 */
@Service
@AiService
public class RagService {

    @SystemMessage("""
        ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½é—®ç­”åŠ©æ‰‹ã€‚
        è¯·åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚
        å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·è¯šå®åœ°è¯´"æˆ‘ä¸çŸ¥é“"ã€‚
        ä¸è¦ç¼–é€ ç­”æ¡ˆã€‚
        """)
    
    /**
     * åŸºäºä¸Šä¸‹æ–‡å›ç­”é—®é¢˜
     */
    public String answer(String question, String context);
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">1.4 æ§åˆ¶å™¨å±‚</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatController.java</div>
                        <div class="text-xs text-gray-400">REST API</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.controller;

import com.example.langchain4j.model.ChatRequest;
import com.example.langchain4j.model.ChatResponse;
import com.example.langchain4j.service.ChatService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import jakarta.validation.Valid;

/**
 * èŠå¤©æ§åˆ¶å™¨
 * æä¾›REST APIæ¥å£
 */
@RestController
@RequestMapping("/api/chat")
@RequiredArgsConstructor
public class ChatController {

    private final ChatService chatService;

    /**
     * å‘é€èŠå¤©æ¶ˆæ¯
     */
    @PostMapping
    public ResponseEntity&lt;ChatResponse&gt; chat(
        @Valid @RequestBody ChatRequest request
    ) {
        String response = chatService.chat(request.getMessage());
        
        return ResponseEntity.ok(ChatResponse.builder()
            .message(response)
            .timestamp(System.currentTimeMillis())
            .build());
    }

    /**
     * å¥åº·æ£€æŸ¥
     */
    @GetMapping("/health")
    public ResponseEntity&lt;String&gt; health() {
        return ResponseEntity.ok("Chat service is running");
    }
}

/**
 * è¯·æ±‚æ¨¡å‹
 */
@Data
class ChatRequest {
    @NotBlank(message = "æ¶ˆæ¯ä¸èƒ½ä¸ºç©º")
    @Size(max = 4000, message = "æ¶ˆæ¯é•¿åº¦ä¸èƒ½è¶…è¿‡4000å­—ç¬¦")
    private String message;
}

/**
 * å“åº”æ¨¡å‹
 */
@Data
@Builder
class ChatResponse {
    private String message;
    private long timestamp;
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">2</span>
                    Quarkus é›†æˆ
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">2.1 ä¾èµ–é…ç½®</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">pom.xml</div>
                        <div class="text-xs text-gray-400">Quarkus Mavené…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;langchain4j-quarkus&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    
    &lt;properties&gt;
        &lt;compiler-plugin.version&gt;3.11.0&lt;/compiler-plugin.version&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;langchain4j.version&gt;0.36.2&lt;/langchain4j.version&gt;
        &lt;quarkus.platform.artifact-id&gt;quarkus-bom&lt;/quarkus.platform.artifact-id&gt;
        &lt;quarkus.platform.group-id&gt;io.quarkus.platform&lt;/quarkus.platform.group-id&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;
                &lt;artifactId&gt;${quarkus.platform.artifact-id}&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;dependencies&gt;
        &lt;!-- Quarkus REST --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-rest-jackson&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Quarkus Hibernate ORM --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-hibernate-orm&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Quarkus PostgreSQL --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-jdbc-postgresql&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- LangChain4j --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;
            &lt;artifactId&gt;langchain4j-open-ai&lt;/artifactId&gt;
            &lt;version&gt;${langchain4j.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- LangChain4j Quarkus Extension --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.quarkiverse.langchain4j&lt;/groupId&gt;
            &lt;artifactId&gt;quarkus-langchain4j-openai&lt;/artifactId&gt;
            &lt;version&gt;0.15.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
                &lt;artifactId&gt;quarkus-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.8.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;build&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">2.2 application.properties</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">application.properties</div>
                        <div class="text-xs text-gray-400">Quarkusé…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-properties"># Applicationé…ç½®
quarkus.application.name=langchain4j-quarkus
quarkus.http.port=8080

# OpenAIé…ç½®
quarkus.langchain4j.openai.api-key=${OPENAI_API_KEY}
quarkus.langchain4j.openai.chat-model.model-name=gpt-4
quarkus.langchain4j.openai.chat-model.temperature=0.7
quarkus.langchain4j.openai.chat-model.max-tokens=1000

# æ•°æ®åº“é…ç½®
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/langchain4j
quarkus.datasource.username=postgres
quarkus.datasource.password=${DB_PASSWORD}
quarkus.datasource.db-kind=postgresql

# Hibernate ORMé…ç½®
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.log.sql=true

# æ—¥å¿—é…ç½®
quarkus.log.level=INFO
quarkus.log.category."com.example".level=DEBUG
quarkus.log.category."dev.langchain4j".level=INFO

# æ„å»ºé…ç½®ï¼ˆåŸç”Ÿé•œåƒï¼‰
quarkus.native.enabled=false
quarkus.package.type=fast-jar
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">2.3 CDI Beanå®šä¹‰</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">ChatService.java</div>
                        <div class="text-xs text-gray-400">CDI Bean</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.service;

import dev.langchain4j.service.AiServices;
import dev.langchain4j.service.SystemMessage;
import dev.langchain4j.service.UserMessage;
import dev.langchain4j.service.spring.AiService;
import io.quarkus.langchain4j.RegisterAiService;
import jakarta.enterprise.context.ApplicationScoped;

/**
 * èŠå¤©æœåŠ¡
 * ä½¿ç”¨@ApplicationScopedæ³¨è§£æ³¨å†Œä¸ºCDI Bean
 */
@ApplicationScoped
@RegisterAiService
public class ChatService {

    @SystemMessage("""
        ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚
        ç”¨ç®€æ´ã€æœ‰ç”¨çš„æ–¹å¼å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
        """)
    
    public String chat(@UserMessage String userMessage);
}

/**
 * RESTèµ„æº
 */
@ApplicationScoped
@Path("/api/chat")
public class ChatResource {

    @Inject
    ChatService chatService;

    @POST
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    public Response chat(ChatRequest request) {
        String response = chatService.chat(request.getMessage());
        
        return Response.ok(ChatResponse.builder()
            .message(response)
            .timestamp(System.currentTimeMillis())
            .build())
            .build();
    }

    @GET
    @Path("/health")
    @Produces(MediaType.TEXT_PLAIN)
    public String health() {
        return "Chat service is running";
    }
}

/**
 * è¯·æ±‚DTO
 */
public record ChatRequest(String message) {}

/**
 * å“åº”DTO
 */
public record ChatResponse(String message, long timestamp) {}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">3</span>
                    æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">3.1 Kafkaå¼‚æ­¥å¤„ç†</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">KafkaConfig.java</div>
                        <div class="text-xs text-gray-400">Kafkaé…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.config;

import org.apache.kafka.clients.consumer.ConsumerConfig;
import org.apache.kafka.clients.producer.ProducerConfig;
import org.apache.kafka.common.serialization.StringDeserializer;
import org.apache.kafka.common.serialization.StringSerializer;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.kafka.annotation.EnableKafka;
import org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;
import org.springframework.kafka.core.*;

import java.util.HashMap;
import java.util.Map;

/**
 * Kafkaé…ç½®
 */
@Configuration
@EnableKafka
public class KafkaConfig {

    @Value("${spring.kafka.bootstrap-servers}")
    private String bootstrapServers;

    /**
     * ç”Ÿäº§è€…é…ç½®
     */
    @Bean
    public ProducerFactory&lt;String, String&gt; producerFactory() {
        Map&lt;String, Object&gt; config = new HashMap&lt;&gt;();
        config.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        config.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        config.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        config.put(ProducerConfig.ACKS_CONFIG, "all");
        config.put(ProducerConfig.RETRIES_CONFIG, 3);
        return new DefaultKafkaProducerFactory&lt;&gt;(config);
    }

    @Bean
    public KafkaTemplate&lt;String, String&gt; kafkaTemplate() {
        return new KafkaTemplate&lt;&gt;(producerFactory());
    }

    /**
     * æ¶ˆè´¹è€…é…ç½®
     */
    @Bean
    public ConsumerFactory&lt;String, String&gt; consumerFactory() {
        Map&lt;String, Object&gt; config = new HashMap&lt;&gt;();
        config.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        config.put(ConsumerConfig.GROUP_ID_CONFIG, "langchain4j-group");
        config.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        config.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        config.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");
        return new DefaultKafkaConsumerFactory&lt;&gt;(config);
    }

    @Bean
    public ConcurrentKafkaListenerContainerFactory&lt;String, String&gt; kafkaListenerContainerFactory() {
        ConcurrentKafkaListenerContainerFactory&lt;String, String&gt; factory = 
            new ConcurrentKafkaListenerContainerFactory&lt;&gt;();
        factory.setConsumerFactory(consumerFactory());
        return factory;
    }
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">3.2 Kafkaç”Ÿäº§è€…</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">KafkaProducerService.java</div>
                        <div class="text-xs text-gray-400">æ¶ˆæ¯ç”Ÿäº§è€…</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.stereotype.Service;

/**
 * Kafkaç”Ÿäº§è€…æœåŠ¡
 * å°†èŠå¤©è¯·æ±‚å‘é€åˆ°Kafkaé˜Ÿåˆ—
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class KafkaProducerService {

    private final KafkaTemplate&lt;String, String&gt; kafkaTemplate;
    private final ObjectMapper objectMapper = new ObjectMapper();

    /**
     * å‘é€èŠå¤©è¯·æ±‚
     * @param topic Kafkaä¸»é¢˜
     * @param requestId è¯·æ±‚ID
     * @param request èŠå¤©è¯·æ±‚
     */
    public void sendChatRequest(String topic, String requestId, ChatRequest request) {
        try {
            String message = objectMapper.writeValueAsString(request);
            kafkaTemplate.send(topic, requestId, message);
            
            log.info("æ¶ˆæ¯å·²å‘é€: topic={}, requestId={}", topic, requestId);
        } catch (Exception e) {
            log.error("å‘é€æ¶ˆæ¯å¤±è´¥: topic={}, requestId={}", topic, requestId, e);
            throw new RuntimeException("å‘é€æ¶ˆæ¯å¤±è´¥", e);
        }
    }
}

/**
 * æ§åˆ¶å™¨
 */
@RestController
@RequestMapping("/api/chat")
public class AsyncChatController {

    private final KafkaProducerService kafkaProducerService;

    @PostMapping("/async")
    public ResponseEntity&lt;Map&lt;String, String&gt;&gt; asyncChat(
        @RequestBody ChatRequest request
    ) {
        String requestId = UUID.randomUUID().toString();
        
        // å‘é€åˆ°Kafka
        kafkaProducerService.sendChatRequest("chat-requests", requestId, request);
        
        return ResponseEntity.ok(Map.of(
            "requestId", requestId,
            "status", "processing",
            "message", "è¯·æ±‚å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­"
        ));
    }
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">3.3 Kafkaæ¶ˆè´¹è€…</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">KafkaConsumerService.java</div>
                        <div class="text-xs text-gray-400">æ¶ˆæ¯æ¶ˆè´¹è€…</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.kafka.support.Acknowledgment;
import org.springframework.kafka.support.KafkaHeaders;
import org.springframework.messaging.handler.annotation.Header;
import org.springframework.messaging.handler.annotation.Payload;
import org.springframework.stereotype.Service;

/**
 * Kafkaæ¶ˆè´¹è€…æœåŠ¡
 * å¼‚æ­¥å¤„ç†èŠå¤©è¯·æ±‚
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class KafkaConsumerService {

    private final ChatService chatService;
    private final ObjectMapper objectMapper = new ObjectMapper();

    /**
     * ç›‘å¬èŠå¤©è¯·æ±‚ä¸»é¢˜
     */
    @KafkaListener(
        topics = "chat-requests",
        groupId = "langchain4j-group",
        containerFactory = "kafkaListenerContainerFactory"
    )
    public void processChatRequest(
        @Payload String message,
        @Header(KafkaHeaders.RECEIVED_KEY) String requestId,
        Acknowledgment acknowledgment
    ) {
        log.info("æ”¶åˆ°æ¶ˆæ¯: requestId={}", requestId);

        try {
            // 1. è§£æè¯·æ±‚
            ChatRequest request = objectMapper.readValue(message, ChatRequest.class);
            
            // 2. è°ƒç”¨AIç”Ÿæˆå›å¤
            String response = chatService.chat(request.getMessage());
            
            // 3. å¤„ç†å“åº”ï¼ˆå¯ä»¥å‘é€åˆ°å¦ä¸€ä¸ªKafkaä¸»é¢˜ï¼‰
            processResponse(requestId, response);
            
            // 4. æ‰‹åŠ¨æäº¤åç§»é‡
            if (acknowledgment != null) {
                acknowledgment.acknowledge();
            }
            
            log.info("æ¶ˆæ¯å¤„ç†å®Œæˆ: requestId={}", requestId);
            
        } catch (Exception e) {
            log.error("å¤„ç†æ¶ˆæ¯å¤±è´¥: requestId={}", requestId, e);
            // å¯ä»¥é€‰æ‹©ä¸æäº¤åç§»é‡ï¼Œè®©Kafkaé‡æ–°æŠ•é€’
        }
    }

    /**
     * å¤„ç†AIå›å¤
     */
    private void processResponse(String requestId, String response) {
        // å¯ä»¥å‘é€åˆ°å¦ä¸€ä¸ªä¸»é¢˜æˆ–å†™å…¥æ•°æ®åº“
        log.debug("AIå›å¤: requestId={}, response={}", requestId, response);
    }
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <span class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center text-xl font-bold">4</span>
                    æ•°æ®å­˜å‚¨é›†æˆ
                </h2>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">4.1 PostgreSQLå‘é‡å­˜å‚¨</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">PgVectorConfig.java</div>
                        <div class="text-xs text-gray-400">PGVectoré…ç½®</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.config;

import dev.langchain4j.data.segment.TextSegment;
import dev.langchain4j.store.embedding.EmbeddingStoreFactory;
import dev.langchain4j.store.embedding.pgvector.PgVectorEmbeddingStore;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import jakarta.sql.DataSource;

/**
 * PGVectoré…ç½®
 * å°†å‘é‡å­˜å‚¨åœ¨PostgreSQLä¸­
 */
@Configuration
public class PgVectorConfig {

    @Value("${pgvector.host}")
    private String host;

    @Value("${pgvector.port}")
    private int port;

    @Value("${pgvector.database}")
    private String database;

    @Value("${pgvector.user}")
    private String user;

    @Value("${pgvector.password}")
    private String password;

    @Value("${pgvector.table}")
    private String table;

    /**
     * åˆ›å»ºPGVectoråµŒå…¥å­˜å‚¨
     */
    @Bean
    public PgVectorEmbeddingStore embeddingStore(DataSource dataSource) {
        return PgVectorEmbeddingStore.builder()
            .host(host)
            .port(port)
            .database(database)
            .user(user)
            .password(password)
            .table(table)
            .dimension(1536)  // OpenAI text-embedding-3-smallçš„ç»´åº¦
            .createTable(true)  // è‡ªåŠ¨åˆ›å»ºè¡¨
            .dropTableFirst(false)
            .build();
    }
}
                    </code></pre>
                </div>

                <h3 class="text-xl font-semibold text-gray-900 mb-4">4.2 Redisç¼“å­˜é›†æˆ</h3>
                <div class="bg-gray-900 rounded-lg p-5 mb-8 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs text-gray-400">RedisCacheService.java</div>
                        <div class="text-xs text-gray-400">Redisç¼“å­˜æœåŠ¡</div>
                    </div>
                    <pre class="text-gray-100 text-sm overflow-x-auto"><code class="language-java">package com.example.langchain4j.service;

import dev.langchain4j.data.segment.TextSegment;
import dev.langchain4j.store.embedding.EmbeddingMatch;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.concurrent.TimeUnit;

/**
 * Redisç¼“å­˜æœåŠ¡
 * ç¼“å­˜Embeddingå’Œæœç´¢ç»“æœ
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class RedisCacheService {

    private final RedisTemplate&lt;String, Object&gt; redisTemplate;

    private static final String EMBEDDING_PREFIX = "embedding:";
    private static final String SEARCH_PREFIX = "search:";
    private static final long CACHE_TTL_HOURS = 1;

    /**
     * ç¼“å­˜Embedding
     */
    public void cacheEmbedding(String text, double[] embedding) {
        String key = EMBEDDING_PREFIX + generateKey(text);
        redisTemplate.opsForValue().set(key, embedding, CACHE_TTL_HOURS, TimeUnit.HOURS);
        log.debug("Embeddingå·²ç¼“å­˜: key={}", key);
    }

    /**
     * è·å–ç¼“å­˜çš„Embedding
     */
    public double[] getCachedEmbedding(String text) {
        String key = EMBEDDING_PREFIX + generateKey(text);
        double[] embedding = (double[]) redisTemplate.opsForValue().get(key);
        
        if (embedding != null) {
            log.debug("å‘½ä¸­Embeddingç¼“å­˜: key={}", key);
        }
        
        return embedding;
    }

    /**
     * ç¼“å­˜æœç´¢ç»“æœ
     */
    public void cacheSearchResults(String query, List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt; results) {
        String key = SEARCH_PREFIX + generateKey(query);
        redisTemplate.opsForValue().set(key, results, 30, TimeUnit.MINUTES);
        log.debug("æœç´¢ç»“æœå·²ç¼“å­˜: key={}, results={}", key, results.size());
    }

    /**
     * è·å–ç¼“å­˜çš„æœç´¢ç»“æœ
     */
    public List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt; getCachedSearchResults(String query) {
        String key = SEARCH_PREFIX + generateKey(query);
        @SuppressWarnings("unchecked")
        List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt; results = 
            (List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt;) redisTemplate.opsForValue().get(key);
        
        if (results != null) {
            log.debug("å‘½ä¸­æœç´¢ç»“æœç¼“å­˜: key={}, results={}", key, results.size());
        }
        
        return results;
    }

    /**
     * ç”Ÿæˆç¼“å­˜é”®
     */
    private String generateKey(String text) {
        return String.valueOf(text.hashCode());
    }

    /**
     * æ¸…é™¤ç¼“å­˜
     */
    public void clearCache(String prefix) {
        Set&lt;String&gt; keys = redisTemplate.keys(prefix + "*");
        if (keys != null && !keys.isEmpty()) {
            redisTemplate.delete(keys);
            log.info("æ¸…é™¤ç¼“å­˜: prefix={}, count={}", prefix, keys.size());
        }
    }
}

/**
 * RAGæœåŠ¡é›†æˆç¼“å­˜
 */
@Service
public class RagServiceWithCache {

    private final RedisCacheService cacheService;
    private final EmbeddingStore&lt;TextSegment&gt; embeddingStore;
    private final EmbeddingModel embeddingModel;

    public List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt; search(String query, int topK) {
        // 1. æ£€æŸ¥æœç´¢ç»“æœç¼“å­˜
        List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt; cached = cacheService.getCachedSearchResults(query);
        if (cached != null) {
            return cached;
        }

        // 2. ç”ŸæˆæŸ¥è¯¢å‘é‡
        double[] queryEmbedding = embeddingModel.embed(query).content();

        // 3. æœç´¢å‘é‡åº“
        List&lt;EmbeddingMatch&lt;TextSegment&gt;&gt; results = 
            embeddingStore.findRelevant(queryEmbedding, topK);

        // 4. ç¼“å­˜ç»“æœ
        cacheService.cacheSearchResults(query, results);

        return results;
    }
}
                    </code></pre>
                </div>
            </section>

            <section class="mb-16">
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg p-8 text-white">
                    <h2 class="text-2xl font-bold mb-4">ğŸ¯ é›†æˆæ€»ç»“</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸƒ</div>
                            <div class="font-semibold mb-2">Spring Boot</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ @AiServiceè‡ªåŠ¨æ³¨å†Œ</li>
                                <li>â€¢ ä¾èµ–æ³¨å…¥</li>
                                <li>â€¢ é…ç½®å¤–éƒ¨åŒ–</li>
                                <li>â€¢ Actuatorç›‘æ§</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">âš¡</div>
                            <div class="font-semibold mb-2">Quarkus</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ CDIé›†æˆ</li>
                                <li>â€¢ åŸç”Ÿç¼–è¯‘</li>
                                <li>â€¢ å¿«é€Ÿå¯åŠ¨</li>
                                <li>â€¢ ä½å†…å­˜å ç”¨</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸ”„</div>
                            <div class="font-semibold mb-2">Kafka</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ å¼‚æ­¥æ¶ˆæ¯å¤„ç†</li>
                                <li>â€¢ è§£è€¦ç³»ç»Ÿ</li>
                                <li>â€¢ æ¶ˆæ¯æŒä¹…åŒ–</li>
                                <li>â€¢ å¯æ‰©å±•æ€§</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸ’¾</div>
                            <div class="font-semibold mb-2">PostgreSQL</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ PGVectoræ‰©å±•</li>
                                <li>â€¢ å‘é‡å­˜å‚¨</li>
                                <li>â€¢ æ•°æ®æŒä¹…åŒ–</li>
                                <li>â€¢ äº‹åŠ¡æ”¯æŒ</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸ”´</div>
                            <div class="font-semibold mb-2">Redis</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ ç¼“å­˜Embedding</li>
                                <li>â€¢ ç¼“å­˜æœç´¢ç»“æœ</li>
                                <li>â€¢ ä¼šè¯ç®¡ç†</li>
                                <li>â€¢ åˆ†å¸ƒå¼é”</li>
                            </ul>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-5 hover:border-indigo-300 transition-colors">
                            <div class="text-2xl mb-3">ğŸ”</div>
                            <div class="font-semibold mb-2">å®‰å…¨å®è·µ</div>
                            <ul class="text-sm space-y-1">
                                <li>â€¢ APIå¯†é’¥ç®¡ç†</li>
                                <li>â€¢ ç¯å¢ƒå˜é‡</li>
                                <li>â€¢ è®¿é—®æ§åˆ¶</li>
                                <li>â€¢ æ•°æ®åŠ å¯†</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <p class="text-lg mb-2">ğŸ“š <strong>ä¸‹ä¸€ç« ï¼štesting-strategies.html</strong></p>
                        <p class="text-sm">å­¦ä¹ LangChain4jåº”ç”¨çš„æµ‹è¯•ç­–ç•¥ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>
</html>
