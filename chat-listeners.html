<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŠå¤©ç›‘å¬å™¨ - LangChain4j å­¦ä¹ æŒ‡å—</title>
    <!-- æ¨¡å—åŒ–CSS -->
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="page-container">
        


<aside class="sidebar">
  <div class="sidebar-content">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon">
        <svg class="sidebar-logo-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
      <div>
        <h1 class="sidebar-logo-title">LangChain4j</h1>
        <p class="sidebar-logo-subtitle">å…¥é—¨æŒ‡å—</p>
      </div>
    </div>

    <div class="space-y-6">
      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">å¿«é€Ÿå¼€å§‹</h3>
        <ul class="sidebar-nav-list">
          <li><a href="index.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="index">æ¦‚è§ˆ</a></li>
          <li><a href="getting-started.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="getting-started">ç¯å¢ƒå‡†å¤‡</a></li>
          <li><a href="core-concepts.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="core-concepts">æ ¸å¿ƒæ¦‚å¿µ</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">æ ¸å¿ƒåŠŸèƒ½</h3>
        <ul class="sidebar-nav-list">
          <li><a href="embedding-models.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="embedding-models">Embedding æ¨¡å‹</a></li>
          <li><a href="prompt-templates.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="prompt-templates">Prompt æ¨¡æ¿</a></li>
          <li><a href="output-parsers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="output-parsers">è¾“å‡ºè§£æ</a></li>
          <li><a href="model-providers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="model-providers">æ¨¡å‹æä¾›å•†</a></li>
          <li><a href="function-calling-deep.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="function-calling-deep">å‡½æ•°è°ƒç”¨</a></li>
          <li><a href="advanced-features.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="advanced-features">é«˜çº§ç‰¹æ€§</a></li>
          <li><a href="multimodal-full.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="multimodal-full">å¤šæ¨¡æ€</a></li>
        </ul>
      </div>

       <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">RAG å®Œæ•´æŒ‡å—</h3>
        <ul class="sidebar-nav-list">
          <li><a href="rag-intro.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-intro">RAG ç®€ä»‹</a></li>
          <li><a href="rag-setup.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-setup">RAG ç¯å¢ƒæ­å»º</a></li>
          <li><a href="rag-implementation.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-implementation">RAG å®ç°</a></li>
          <li><a href="rag-advanced.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-advanced">RAG é«˜çº§</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">é¡¹ç›®å®æˆ˜</h3>
        <ul class="sidebar-nav-list">
          <li><a href="project-chatbot.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="project-chatbot">èŠå¤©æœºå™¨äºº</a></li>
          <li><a href="project-ai-assistant.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="project-ai-assistant">AIåŠ©æ‰‹</a></li>
          <li><a href="project-rag-kb.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="project-rag-kb">RAGçŸ¥è¯†åº“</a></li>
          <li><a href="practice.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="practice">ç»¼åˆå®æˆ˜</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">æœ€ä½³å®è·µ</h3>
        <ul class="sidebar-nav-list">
          <li><a href="best-practices.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="best-practices">æœ€ä½³å®è·µ</a></li>
          <li><a href="testing-strategies.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="testing-strategies">æµ‹è¯•ç­–ç•¥</a></li>
          <li><a href="performance-tuning.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="performance-tuning">æ€§èƒ½ä¼˜åŒ–</a></li>
          <li><a href="deep-dive.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="deep-dive">æ·±åº¦è§£æ</a></li>
          <li><a href="error-handling.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="error-handling">é”™è¯¯å¤„ç†</a></li>
          <li><a href="moderation-safety.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="moderation-safety">å†…å®¹å®¡æ ¸</a></li>
          <li><a href="troubleshooting.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="troubleshooting">æ•…éšœæ’æŸ¥</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">é¢è¯•å‡†å¤‡</h3>
        <ul class="sidebar-nav-list">
          <li><a href="interview-prep.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="interview-prep">é¢è¯•å‡†å¤‡</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">å…¶ä»–</h3>
        <ul class="sidebar-nav-list">
          <li><a href="search.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="search">å‘é‡æœç´¢</a></li>
          <li><a href="chat-listeners.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="chat-listeners">ç›‘å¬å™¨</a></li>
          <li><a href="faq.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="faq">å¸¸è§é—®é¢˜</a></li>
          <li><a href="cost-optimization.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="cost-optimization">æˆæœ¬ä¼˜åŒ–</a></li>
          <li><a href="deployment.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="deployment">éƒ¨ç½²ä¸Šçº¿</a></li>
          <li><a href="integrations.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="integrations">æ¡†æ¶é›†æˆ</a></li>
          <li><a href="examples.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="examples">å®æˆ˜ç¤ºä¾‹</a></li>
        </ul>
      </div>
    </div>
  </div>
</aside>





        <main class="main-content">
            <div class="content-wrapper">
                <!-- é¡µé¢æ ‡ç­¾ -->
                <div class="flex items-center gap-2 mb-4">
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-700 text-xs font-medium rounded-full">èŠå¤©ç›‘å¬å™¨</span>
                    <span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-medium rounded-full">äº‹ä»¶å¤„ç†</span>
                    <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full">å¼‚æ­¥ç¼–ç¨‹</span>
                </div>

                <h1 class="page-title">ç›‘å¬å™¨</h1>
                <p class="page-intro">LangChain4j çš„èŠå¤©ç›‘å¬å™¨æœºåˆ¶ä¸äº‹ä»¶å¤„ç†</p>

                <!-- ç›®å½• -->
                <nav class="bg-gray-50 border border-gray-200 rounded-xl p-6 mb-8">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">ç›®å½•</h3>
                    <ol class="toc-list">
                        <li class="toc-item"><span class="toc-number">1.</span> <a href="#ç›‘å¬å™¨æ¦‚è¿°" class="toc-link">ç›‘å¬å™¨æ¦‚è¿°</a></li>
                        <li class="toc-item"><span class="toc-number">2.</span> <a href="#ç›‘å¬å™¨ç±»å‹" class="toc-link">ç›‘å¬å™¨ç±»å‹</a></li>
                        <li class="toc-item"><span class="toc-number">3.</span> <a href="#ç›‘å¬å™¨å®ç°" class="toc-link">ç›‘å¬å™¨å®ç°</a></li>
                        <li class="toc-item"><span class="toc-number">4.</span> <a href="#å®æˆ˜åº”ç”¨" class="toc-link">å®æˆ˜åº”ç”¨</a></li>
                    </ol>
                </nav>

                <!-- ç¬¬1èŠ‚ï¼šç›‘å¬å™¨æ¦‚è¿° -->
                <section id="ç›‘å¬å™¨æ¦‚è¿°" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">1</span>
                        <h2 class="text-2xl font-bold text-gray-900">ç›‘å¬å™¨æ¦‚è¿°</h2>
                    </div>

                    <h3 class="subsection-title">1.1 ç›‘å¬å™¨æ¦‚å¿µ</h3>
                    <p class="paragraph">èŠå¤©ç›‘å¬å™¨æ˜¯ LangChain4j æä¾›çš„ä¸€ç§äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œç”¨äºç›‘å¬å’Œå“åº”èŠå¤©è¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶ï¼š</p>

                    <div class="grid-3col">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">äº‹ä»¶ç±»å‹</h4>
                            <p class="text-blue-700 text-sm">ç›‘å¬å™¨å¯ä»¥å“åº”å¤šç§äº‹ä»¶ï¼š</p>
                            <ul class="text-blue-600 text-xs space-y-1">
                                <li> æ¶ˆæ¯å‘é€å‰</li>
                                <li> æ¶ˆæ¯å‘é€å</li>
                                <li> æ¨¡å‹å¼€å§‹ç”Ÿæˆ</li>
                                <li> æ¨¡å‹ç”Ÿæˆå®Œæˆ</li>
                                <li> Token ä½¿ç”¨æ›´æ–°</li>
                            </ul>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-2">åº”ç”¨åœºæ™¯</h4>
                            <p class="text-green-700 text-sm">ç›‘å¬å™¨çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</p>
                            <ul class="text-green-600 text-xs space-y-1">
                                <li> æ—¥å¿—è®°å½•å’Œå®¡è®¡</li>
                                <li> Token ä½¿ç”¨ç›‘æ§</li>
                                <li> æ¶ˆæ¯ä¸­é—´ä»¶å¤„ç†</li>
                                <li> è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘è§¦å‘</li>
                                <li> æµç¨‹æ§åˆ¶å’Œæ‹¦æˆª</li>
                            </ul>
                        </div>
                        <div class="purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">æ ¸å¿ƒä¼˜åŠ¿</h4>
                            <p class="text-purple-700 text-sm">ä½¿ç”¨ç›‘å¬å™¨çš„ä¼˜åŠ¿ï¼š</p>
                            <ul class="text-purple-600 text-xs space-y-1">
                                <li> è§£è€¦ï¼šå°†ä¸šåŠ¡é€»è¾‘ä»ä¸»æµç¨‹ä¸­åˆ†ç¦»</li>
                                <li> å¯æµ‹è¯•ï¼šç‹¬ç«‹æµ‹è¯•ç›‘å¬å™¨é€»è¾‘</li>
                                <li> å¯æ‰©å±•ï¼šåŠ¨æ€æ·»åŠ å’Œç§»é™¤ç›‘å¬å™¨</li>
                                <li> è§‚å¯Ÿè€…æ¨¡å¼ï¼šæ˜“äºå®ç°å¤æ‚çš„äº‹ä»¶é“¾</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- ç¬¬2èŠ‚ï¼šç›‘å¬å™¨ç±»å‹ -->
                <section id="ç›‘å¬å™¨ç±»å‹" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">2</span>
                        <h2 class="text-2xl font-bold text-gray-900">ç›‘å¬å™¨ç±»å‹</h2>
                    </div>

                    <h3 class="subsection-title">2.1 å†…ç½®ç›‘å¬å™¨</h3>
                    <p class="paragraph">LangChain4j æä¾›äº†å¤šç§å†…ç½®ç›‘å¬å™¨ï¼š</p>

                    <table class="w-full text-left border-collapse border border-gray-200 rounded-lg overflow-hidden mb-6">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-sm font-semibold text-gray-500">ç›‘å¬å™¨</th>
                                <th class="px-6 py-3 text-sm font-semibold text-gray-500">è§¦å‘æ—¶æœº</th>
                                <th class="px-6 py-3 text-sm font-semibold text-gray-500">ç”¨é€”</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-200">
                                <td class="px-6 py-3"><strong>ModelListener</strong></td>
                                <td class="px-6 py-3">æ¨¡å‹ç”Ÿæˆè¿‡ç¨‹ä¸­</td>
                                <td class="px-6 py-3">ç›‘æ§æ¨¡å‹å“åº”ã€æµå¼è¾“å‡ºå¤„ç†</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="px-6 py-3"><strong>TokenListener</strong></td>
                                <td class="px-6 py-3">Token ä½¿ç”¨æ—¶</td>
                                <td class="px-6 py-3">å®æ—¶ç›‘æ§ Token æ¶ˆè€—ã€é¢„ç®—æ§åˆ¶</td>
                            </tr>
                            <tr class="border-b border-gray-200">
                                <td class="px-6 py-3"><strong>ChatMemoryListener</strong></td>
                                <td class="px-6 py-3">èŠå¤©è®°å¿†æ›´æ–°æ—¶</td>
                                <td class="px-6 py-3">è®°å¿†æŒä¹…åŒ–ã€ä¸Šä¸‹æ–‡ç®¡ç†</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3"><strong>ToolExecutionListener</strong></td>
                                <td class="px-6 py-3">å·¥å…·æ‰§è¡Œæ—¶</td>
                                <td class="px-6 py-3">æ—¥å¿—è®°å½•ã€æƒé™æ£€æŸ¥ã€ç»“æœå¤„ç†</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- ç¬¬3èŠ‚ï¼šç›‘å¬å™¨å®ç° -->
                <section id="ç›‘å¬å™¨å®ç°" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">3</span>
                        <h2 class="text-2xl font-bold text-gray-900">ç›‘å¬å™¨å®ç°</h2>
                    </div>

                    <h3 class="subsection-title">3.1 ModelListener ç¤ºä¾‹</h3>
                    <p class="paragraph">ä½¿ç”¨ ModelListener ç›‘æ§æ¨¡å‹ç”Ÿæˆè¿‡ç¨‹ï¼š</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">ModelListenerExample.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.listeners</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.listener.ModelListener</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.ChatLanguageModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.listener.ChatMemoryContext</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.listener.ChatMemoryId</span>;

<span class="text-gray-500">/**
 * æ¨¡å‹ç›‘å¬å™¨ç¤ºä¾‹
 * ç›‘æ§æ¨¡å‹ç”Ÿæˆè¿‡ç¨‹å¹¶è®°å½•æ—¥å¿—
 */</span>
<span class="code-keyword">public class</span> <span class="code-class">LoggingModelListener</span> <span class="code-keyword">implements</span> <span class="text-blue-300">ModelListener</span> {

    <span class="code-keyword">@Override</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">onRequest</span>(<span class="text-blue-300">ChatMemoryContext</span> context, <span class="text-blue-300">ChatMemoryId</span> memoryId) {
        <span class="text-gray-500">// è®°å½•è¯·æ±‚å¼€å§‹</span>
        <span class="text-blue-300">System</span>.<span class="code-string">out</span>.<span class="code-string">printf</span>(<span class="code-string">"[%s] è¯·æ±‚å¼€å§‹ - Memory ID: %s"</span>, 
            context.<span class="code-string">chatMemoryId</span>(), memoryId);
    }

    <span class="code-keyword">@Override</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">onResponse</span>(<span class="text-blue-300">ChatMemoryContext</span> context, <span class="text-blue-300">ChatMemoryId</span> memoryId, <span class="text-blue-300">AiMessage</span> response) {
        <span class="text-gray-500">// è®°å½•å“åº”å®Œæˆ</span>
        <span class="text-blue-300">System</span>.<span class="code-string">out</span>.<span class="code-string">printf</span>(<span class="code-string">"[%s] å“åº”å®Œæˆ - Memory ID: %s - å†…å®¹: %s"</span>,
            context.<span class="code-string">chatMemoryId</span>(), memoryId, response.<span class="code-string">text</span>());
    }

    <span class="code-keyword">@Override</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">onError</span>(<span class="text-blue-300">ChatMemoryContext</span> context, <span class="text-blue-300">ChatMemoryId</span> memoryId, <span class="text-blue-300">Throwable</span> error) {
        <span class="text-gray-500">// è®°å½•é”™è¯¯</span>
        <span class="text-blue-300">System</span>.<span class="code-string">err</span>.<span class="code-string">println</span>(<span class="code-string">"[%s] é”™è¯¯å‘ç”Ÿ - Memory ID: %s - Error: %s"</span>,
            context.<span class="code-string">chatMemoryId</span>(), memoryId, error.<span class="code-string">getMessage</span>());
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">3.2 TokenListener ç¤ºä¾‹</h3>
                    <p class="paragraph">ä½¿ç”¨ TokenListener ç›‘æ§ Token ä½¿ç”¨ï¼š</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">TokenListenerExample.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.listeners</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.listener.TokenListener</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.concurrent.atomic.AtomicLong</span>;

<span class="text-gray-500">/**
 * Token ä½¿ç”¨ç›‘å¬å™¨ç¤ºä¾‹
 * å®æ—¶ç›‘æ§ Token æ¶ˆè€—å’Œæˆæœ¬
 */</span>
<span class="code-keyword">public class</span> <span class="code-class">BudgetTokenListener</span> <span class="code-keyword">implements</span> <span class="text-blue-300">TokenListener</span> {

    <span class="code-keyword">private final</span> <span class="text-blue-300">AtomicLong</span> totalTokens = <span class="code-keyword">new</span> <span class="text-blue-300">AtomicLong</span>(<span class="code-string">0</span>);
    <span class="code-keyword">private static final</span> <span class="text-blue-300">double</span> <span class="code-class">BUDGET_THRESHOLD</span> = <span class="code-string">100000</span>; <span class="text-gray-500">// é¢„ç®—é˜ˆå€¼ï¼š10 ä¸‡ tokens</span>

    <span class="code-keyword">@Override</</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">onToken</span>(<span class="text-blue-300">int</span> tokens, <span class="text-blue-300">TokenRequest</span> request) {
        <span class="text-blue-300">long</span> currentTotal = totalTokens.<span class="code-string">addAndGet</span>(tokens);
        
        <span class="text-gray-500">// æ£€æŸ¥æ˜¯å¦è¶…è¿‡é¢„ç®—</span>
        <span class="code-keyword">if</span> (currentTotal &gt; <span class="code-class">BUDGET_THRESHOLD</span>) {
            <span class="text-blue-300">System</span>.<span class="code-string">out</span>.<span class="code-string">println</span>(<span class="code-string">"âš ï¸  è­¦å‘Šï¼šToken ä½¿ç”¨è¶…è¿‡é¢„ç®—ï¼å½“å‰: "</span> + currentTotal + <span class="code-string">"</span>);
            <span class="text-gray-500">// å¯é€‰æ‹©ï¼šæŠ›å‡ºå¼‚å¸¸ã€é™ä½æ¨¡å‹è´¨é‡ã€æ‹’ç»è¯·æ±‚</span>
        }
    }
}</code></pre>
                    </div>
                </section>

                <!-- ç¬¬4èŠ‚ï¼šå®æˆ˜åº”ç”¨ -->
                <section id="å®æˆ˜åº”ç”¨" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">4</span>
                        <h2 class="text-2xl font-font-bold text-gray-900">å®æˆ˜åº”ç”¨</h2>
                    </div>

                    <h3 class="subsection-title">4.1 é›†æˆç›‘å¬å™¨</h3>
                    <p class="text-gray-700">å°†ç›‘å¬å™¨é›†æˆåˆ° ChatLanguageModelï¼š</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">ListenerIntegration.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">public class</span> <span class="code-class">ListenerIntegration</span> {

    <span class="code-keyword">private final</span> <span class="text-blue-300">ChatLanguageModel</span> chatModel;
    <span class="code-keyword">private final</span> <span class="text-blue-300">ModelListener</span> loggingListener;
    <span class="code-keyword">private final</span> <span class="text-blue-300">TokenListener</span> tokenListener;

    <span class="code-keyword">public</span> <span class="code-class">ListenerIntegration</span>(<span class="text-blue-300">ChatLanguageModel</span> chatModel) {
        <span class="code-keyword">this</span>.chatModel = chatModel;
        <span class="code-keyword">this</span>.loggingListener = <span class="code-keyword">new</span> <span class="code-class">LoggingModelListener</span>();
        <span class="code-keyword">this</span>.tokenListener = <span class="code-keyword">new</span> <span class="code-class">BudgetTokenListener</span>();
        
        <span class="text-gray-500">// æ³¨å†Œç›‘å¬å™¨</span>
        chatModel.<span class="code-string">addListener</span>(loggingListener);
        chatModel.<span class="code-string">addListener</span>(tokenListener);
    }

    <span class="text-gray-500">/**
     * å‘é€æ¶ˆæ¯å¹¶ä½¿ç”¨ç›‘å¬å™¨
     */</span>
    <span class="code-keyword">public</span> <span class="text-blue-300">String</span> <span class="code-keyword">sendMessageWithListeners</span>(<span class="text-blue-300">String</span> message) {
        <span class="code-keyword">return</span> chatModel.<span class="code-string">generate</span>(message);
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">4.2 å¼‚æ­¥å¤„ç†</h3>
                    <p class="text-text-gray-700 mb-6">ç›‘å¬å™¨ä¸­çš„å¼‚æ­¥å¤„ç†æœ€ä½³å®è·µï¼š</p>

                    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                        <h4 class="font-semibold text-green-800 mb-3">å¼‚æ­¥æ³¨æ„äº‹é¡¹</h4>
                        <ul class="text-green-700 space-y-2">
                            <li><strong>é¿å…é˜»å¡</strong>ï¼šç›‘å¬å™¨ä¸­ä¸è¦æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œä½¿ç”¨å¼‚æ­¥ API</li>
                            <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç›‘å¬å™¨ä¸­çš„é”™è¯¯ä¸åº”å½±å“ä¸»æµç¨‹</li>
                            <li><strong>å¹‚ç­‰æ€§</strong>ï¼šç¡®ä¿ç›‘å¬å™¨é€»è¾‘å¯ä»¥å®‰å…¨é‡è¯•</li>
                            <li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šç›‘å¬å™¨å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
                        </ul>
                    </div>

                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 mb-8">
                        <h3 class="text-xl font-bold text-white mb-2">ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“</h3>
                        <ul class="text-indigo-100 space-y-2">
                            <li><strong>è½»é‡çº§ç›‘å¬å™¨</strong>ï¼šå¿«é€Ÿæ‰§è¡Œï¼Œé¿å…å½±å“ä¸»æµç¨‹æ€§èƒ½</li>
                            <li><strong>åˆç†ä½¿ç”¨æ—¥å¿—</strong>ï¼šé€‚å½“çº§åˆ«è®°å½•å…³é”®äº‹ä»¶ï¼Œé¿å…è¿‡åº¦æ—¥å¿—</li>
                            <li><strong>ç»„åˆç›‘å¬å™¨</strong>ï¼šå¤šä¸ªç›‘å¬å™¨å¯ä»¥ååŒå·¥ä½œå®ç°å¤æ‚é€»è¾‘</li>
                            <li><strong>æµ‹è¯•è¦†ç›–</strong>ï¼šä¸ºç›‘å¬å™¨é€»è¾‘ç¼–å†™å•å…ƒæµ‹è¯•</li>
                            <li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šä½¿ç”¨ç›‘å¬å™¨å®ç°æˆæœ¬æ§åˆ¶å’Œå¼‚å¸¸å‘Šè­¦</li>
                        </ul>
                    </div>
                </section>

                <!-- æ€»ç»“ -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-8 text-white">
                    <h3 class="text-2xl font-bold mb-4">æœ¬èŠ‚å°ç»“</h3>
                    <p class="mb-4">æœ¬èŠ‚å®Œæ•´ä»‹ç»äº† LangChain4j çš„èŠå¤©ç›‘å¬å™¨æœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼š</p>
                    <ul class="list-disc list-inside space-y-2 mb-6">
                        <li><strong>ç›‘å¬å™¨æ¦‚è¿°</strong>ï¼šäº‹ä»¶ç±»å‹ã€åº”ç”¨åœºæ™¯ã€æ ¸å¿ƒä¼˜åŠ¿</li>
                        <li><strong>ç›‘å¬å™¨ç±»å‹</strong>ï¼šModelListenerã€TokenListenerã€ChatMemoryListenerã€ToolExecutionListener</li>
                        <li><strong>ç›‘å¬å™¨å®ç°</strong>ï¼šå®Œæ•´çš„ä»£ç ç¤ºä¾‹ã€é›†æˆæ–¹æ³•</li>
                        <li><strong>å®æˆ˜åº”ç”¨</strong>ï¼šç›‘å¬å™¨é›†æˆã€å¼‚æ­¥å¤„ç†ã€æœ€ä½³å®è·µ</li>
                    </ul>
                    <div class="border-t border-indigo-400 pt-6">
                        <p class="text-sm opacity-80 mb-2">ğŸ‰ æ­å–œï¼</p>
                        <p class="text-indigo-100 mb-2">æ‰€æœ‰é«˜çº§ä¸»é¢˜é¡µé¢å·²å®Œæˆï¼å‰©ä½™ 6 ä¸ªå…¥é—¨é¡µé¢å¯æ ¹æ®éœ€è¦è¡¥å……ã€‚</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
