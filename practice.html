<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>实战练习 - LangChain4j 学习指南</title>
    <!-- 模块化CSS -->
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="page-container">
        


<aside class="sidebar">
  <div class="sidebar-content">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon">
        <svg class="sidebar-logo-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
      <div>
        <h1 class="sidebar-logo-title">LangChain4j</h1>
        <p class="sidebar-logo-subtitle">入门指南</p>
      </div>
    </div>

    <div class="space-y-6">
      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">快速开始</h3>
        <ul class="sidebar-nav-list">
          <li><a href="index.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="index">概览</a></li>
          <li><a href="getting-started.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="getting-started">环境准备</a></li>
          <li><a href="core-concepts.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="core-concepts">核心概念</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">核心功能</h3>
        <ul class="sidebar-nav-list">
          <li><a href="embedding-models.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="embedding-models">Embedding 模型</a></li>
          <li><a href="prompt-templates.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="prompt-templates">Prompt 模板</a></li>
          <li><a href="output-parsers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="output-parsers">输出解析</a></li>
          <li><a href="model-providers.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="model-providers">模型提供商</a></li>
          <li><a href="function-calling-deep.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="function-calling-deep">函数调用</a></li>
          <li><a href="advanced-features.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="advanced-features">高级特性</a></li>
          <li><a href="multimodal-full.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="multimodal-full">多模态</a></li>
        </ul>
      </div>

       <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">RAG 完整指南</h3>
        <ul class="sidebar-nav-list">
          <li><a href="rag-intro.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-intro">RAG 简介</a></li>
          <li><a href="rag-setup.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-setup">RAG 环境搭建</a></li>
          <li><a href="rag-implementation.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-implementation">RAG 实现</a></li>
          <li><a href="rag-advanced.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="rag-advanced">RAG 高级</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">项目实战</h3>
        <ul class="sidebar-nav-list">
          <li><a href="project-chatbot.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="project-chatbot">聊天机器人</a></li>
          <li><a href="project-ai-assistant.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="project-ai-assistant">AI助手</a></li>
          <li><a href="project-rag-kb.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="project-rag-kb">RAG知识库</a></li>
          <li><a href="practice.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="practice">综合实战</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">最佳实践</h3>
        <ul class="sidebar-nav-list">
          <li><a href="best-practices.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="best-practices">最佳实践</a></li>
          <li><a href="testing-strategies.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="testing-strategies">测试策略</a></li>
          <li><a href="performance-tuning.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="performance-tuning">性能优化</a></li>
          <li><a href="deep-dive.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="deep-dive">深度解析</a></li>
          <li><a href="error-handling.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="error-handling">错误处理</a></li>
          <li><a href="moderation-safety.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="moderation-safety">内容审核</a></li>
          <li><a href="troubleshooting.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="troubleshooting">故障排查</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">面试准备</h3>
        <ul class="sidebar-nav-list">
          <li><a href="interview-prep.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="interview-prep">面试准备</a></li>
        </ul>
      </div>

      <div class="sidebar-nav-group">
        <h3 class="sidebar-nav-title">其他</h3>
        <ul class="sidebar-nav-list">
          <li><a href="search.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="search">向量搜索</a></li>
          <li><a href="chat-listeners.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="chat-listeners">监听器</a></li>
          <li><a href="faq.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="faq">常见问题</a></li>
          <li><a href="cost-optimization.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="cost-optimization">成本优化</a></li>
          <li><a href="deployment.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="deployment">部署上线</a></li>
          <li><a href="integrations.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="integrations">框架集成</a></li>
          <li><a href="examples.html" class="nav-link block px-4 py-2.5 text-sm text-gray-600 hover:text-indigo-700 hover:bg-indigo-50 rounded-md transition-all" data-page="examples">实战示例</a></li>
        </ul>
      </div>
    </div>
  </div>
</aside>





        <main class="main-content">
            <div class="content-wrapper">
                <!-- 页面标签 -->
                <div class="flex items-center gap-2 mb-4">
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-700 text-xs font-medium rounded-full">实战练习</span>
                    <span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-medium rounded-full">项目实战</span>
                    <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full">完整流程</span>
                </div>

                <h1 class="text-4xl font-bold text-gray-900 mb-4">实战练习</h1>
                <p class="page-intro">通过三个完整的实战项目，掌握 LangChain4j 的实际应用开发</p>

                <!-- 目录 -->
                <nav class="bg-gray-50 border border-gray-200 rounded-xl p-6 mb-8">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">目录</h3>
                    <ol class="toc-list">
                        <li class="toc-item"><span class="toc-number">1.</span> <a href="#实战项目概述" class="toc-link">实战项目概述</a></li>
                        <li class="toc-item"><span class="toc-number">2.</span> <a href="#rag知识库项目实战" class="toc-link">RAG 知识库项目</a></li>
                        <li class="toc-item"><span class="toc-number">3.</span> <a href="#ai助手项目实战" class="toc-link">AI 助手项目</a></li>
                        <li class="toc-item"><span class="toc-number">4.</span> <a href="#聊天机器人项目实战" class="toc-link">聊天机器人项目</a></li>
                    </ol>
                </nav>

                <!-- 第1节：实战项目概述 -->
                <section id="实战项目概述" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">1</span>
                        <h2 class="text-2xl font-bold text-gray-900">实战项目概述</h2>
                    </div>

                    <p class="paragraph">本节介绍三个实战项目的整体设计思路、技术栈选择和项目复杂度，帮助您在实际开发中做出正确的技术决策。</p>

                    <h3 class="subsection-title">1.1 项目类型与复杂度</h3>
                    <p class="text-gray-700 mb-4">三个实战项目代表了 LangChain4j 的典型应用场景：</p>

                    <div class="grid-3col">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">RAG 知识库项目</h4>
                            <p class="text-blue-700 text-sm mb-2">企业级文档管理系统</p>
                            <p class="text-blue-600 text-sm"> 复杂度：⭐⭐⭐⭐</p>
                            <p class="text-blue-600 text-sm"> 核心功能：文档向量化、语义检索、相似度匹配</p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2">AI 助手项目</h4>
                            <p class="text-purple-700 text-sm mb-2">企业级智能助手</p>
                            <p class="text-purple-600 text-sm"> 复杂度：⭐⭐⭐</p>
                            <p class="text-purple-600 text-sm"> 核心功能：多模型支持、上下文管理、函数调用</p>
                        </div>
                        <div class="bg-orange-50 border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2">聊天机器人项目</h4>
                            <p class="text-orange-700 text-sm mb-2">实时聊天应用</p>
                            <p class="text-orange-600 text-sm"> 复杂度：⭐⭐⭐</p>
                            <p class="text-orange-600 text-sm"> 核心功能：实时通信、多用户支持、WebSocket 连接</p>
                        </div>
                    </div>

                    <h3 class="subsection-title">1.2 技术栈选择</h3>
                    <p class="text-gray-700 mb-4">三个项目统一使用以下技术栈：</p>

                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <ul class="space-y-2 text-gray-700 mb-4">
                            <li><strong>LangChain4j</strong>: AI 框架的核心，提供统一的 API</li>
                            <li><strong>Spring Boot 3.2.x</strong>: 企业级应用框架，提供依赖注入和自动配置</li>
                            <li><strong>PostgreSQL</strong>: 向量数据库，支持 PGVector 扩展</li>
                            <li><strong>Redis</strong>: 缓存和会话存储</li>
                            <li><strong>React</strong>: 现代化前端框架（聊天机器人）</li>
                            <li><strong>Docker</strong>: 容器化部署和微服务架构</li>
                            <li><strong>PGVector</strong>: 向量数据库向量扩展，高效相似度搜索</li>
                        </ul>
                    </div>

                    <h3 class="subsection-title">1.3 项目规模与时间估算</h3>
                    <p class="text-gray-700 mb-4">三个项目的规模和开发时间估算：</p>

                    <div class="table-auto border-collapse border border-gray-200 rounded-lg overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-500">项目</th>
                                    <th class="后端复杂度</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-500">前端复杂度</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-500">预估开发周期</th>
                                </tr>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-500">代码行数</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="px-6 py-3">RAG 知识库</td>
                                    <td class="px-6 py-3">⭐⭐⭐⭐</td>
                                    <td class="px-6 py-3">⭐⭐</td>
                                    <td class="px-6 py-3">3-4 周</td>
                                    <td class="px-6 py-3">3000-4000 行</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3">AI 助手</td>
                                    <td class="px-6 py-3">⭐⭐⭐⭐</td>
                                    <td class="px-6 py-3">⭐⭐</td>
                                    <td class="px-6 py-3">4-6 周</td>
                                    <td class="px-6 py-3">4000-5000 行</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3">聊天机器人</td>
                                    <td class="px-6 py-3">⭐⭐⭐⭐</td>
                                    <td class="px-6 py-3">⭐⭐</td>
                                    <td class="px-6 py-3">5-6 周</td>
                                    <td class="px-6 py-3">5000-6000 行</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- 第2节：RAG 知识库项目实战 -->
                <section id="rag知识库项目实战" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">2</span>
                        <h2 class="text-2xl font-bold text-gray-900">RAG 知识库项目实战</h2>
                    </div>

                    <p class="paragraph">构建一个完整的企业级文档管理系统，实现文档向量化、语义检索和智能问答。</p>

                    <h3 class="subsection-title">2.1 系统架构设计</h3>
                    <p class="text-gray-700 mb-4">使用分层架构，确保系统的可扩展性和可维护性：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">RAGArchitecture.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.rag</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.boot.SpringApplication</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.web.bind.annotation.RestController</span>;

<span class="text-gray-500">/**
 * RAG 知识库项目架构
 * 企业级文档管理系统架构
 */</span>
<span class="code-keyword">@RestController</span>
<span class="code-class">RequestMapping</span>(<span class="code-string">"/api/documents"</span>)
<span class="code-keyword">public class</span> <span class="text-blue-300">class</span> <span class="code-class">RagController</span> {

    <span class="text-gray-500">/**
     * 上传文档接口
     */</span>
    <span class="code-keyword">@PostMapping</span>(<span class="code-string">"/upload"</span>)
    <span class="text-blue-300">public</span> <span class="code-class">Document</span> <span class="code-keyword">uploadDocument</span>(<span class="text-blue-300">@RequestParam</span>(<span class="code-string">"file"</span>) <span class="text-blue-300">MultipartFile</span> file) {
        <span class="code-keyword">// 保存文件到向量数据库</span>
        <span class="text-blue-300">String</span> fileId = <span class="code-class">documentService</span>.<span class="code-string">saveDocument</span>(file);
        <span class="code-keyword">return</span> <span class="text-blue-300">fileId</span>;
    }

    <span class="text-gray-500">/**
     * 搜索接口
     */</span>
    <span class="code-keyword">@GetMapping</span>(<span class="code-string">"/search"</span>)
    <span class="text-blue-300">public</span> <span class="code-class">SearchResponse</span> <span class="code-keyword">search</span>(<span class="text-blue-300">@RequestParam</span>(<span class="code-string">"query"</span>) <span class="text-blue-300">String</span> query) {
        <span class="code-keyword">// 调用向量搜索服务</span>
        <span class="text-blue-300">List&lt;Document&gt;</span> documents = <span class="code-class">documentService</span>.<span class="code-string">searchDocuments</span>(query);
        <span class="code-keyword">return</span> <span class="text-blue-300">new</span> <span class="code-class">SearchResponse</span>(<span class="code-string">documents</span>);
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">2.2 向量数据库配置</h3>
                    <p class="text-gray-700 mb-4">配置 PostgreSQL + PGVector 扩展，实现高效的向量存储和相似度计算：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">PGVectorConfig.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.rag</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.context.annotation.Configuration</span>;

<span class="text-gray-500">/**
 * 向量数据库配置
 * 使用 PGVector 扩展实现向量存储
 */</span>
<span class="code-keyword">@Configuration</span>
<span class="code-class">public class</span> <span class="text-blue-300">class</span> <span class="code-class">PGVectorConfig</span> {

    <span class="text-gray-500">/**
     * 向量维度配置
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">int</span> <span class="code-class">vectorDimension = <span class="code-string">1536</span>;

    <span class="text-gray-500">/**
     * 创建 PGVector 扩展
     */</span>
    <span class="code-keyword">@Bean</span>
    <span class="code-class">public</span> <span class="code-string">org.springframework.context.annotation.Bean</span>;
    <span class="text-blue-300">Extension</span> <span class="code-class">createExtension</span>(<span class="code-string">"pgvector"</span>, <span class="text-blue-300">PGVectorExtension</span>.<span class="code-class">class</span>);
}</code></pre>
                    </div>

                    <h3 class="subsection-title">2.3 文档向量化</h3>
                    <p class="text-gray-700 mb-4">使用 Embedding 模型将文档转换为向量：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">DocumentEmbedder.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.rag</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.embedding.EmbeddingModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.List</span>;

<span class="text-gray-500">/**
 * 文档向量化工具
 */</span>
<span class="code-keyword">public class</span> <span class="code-class">DocumentEmbedder</span> {

    <span class="code-keyword">private final</span> <span class="text-blue-300">EmbeddingModel</span> <span class="code-class">embeddingModel</span>;

    <span class="text-gray-500">/**
     * 向量化文档
     */</span>
    <span class="code-keyword">public</span> <span class="text-blue-300">float</span> <span class="code-class">embed</span>(<span class="code-string">String</span> text) {
        <span class="code-keyword">// 调用嵌入模型</span>
        <span class="text-blue-300">return</span> <span class="code-class">embeddingModel</span>.<span class="code-string">embed</span>(text).<span class="text-blue-300">content</span>());
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">2.4 相似度计算</h3>
                    <p class="text-gray-700 mb-4">使用余弦相似度算法计算文档相似度：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">SimilarityCalculator.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.rag</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">java.util.List</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.Map</span>;

<span class="text-gray-500">/**
 * 相似度计算器
 * 使用余弦相似度计算文档相似度
 */</span>
<span class="code-keyword">public class</span> <span class="code-class">SimilarityCalculator</span> {

    <span class="code-keyword">private static</span> <span class="text-blue-300">float</span> <span class="code-class">cosineSimilarity</span>(<span class="code-string">String</span> text1, <span class="text-blue-300">String</span> text2) {
        <span class="code-keyword">// 计算两个字符串的余弦相似度</span>
        <span class="text-blue-300">int</span> len1 = <span class="code-class">text1</span>.<span class="code-string">length</span>();
        <span class="code-keyword">int</span> len2 = <span class="text-blue-300">text2</span>.<span class="code-class">length</span>.<span class="code-string">length</span>();

        <span class="code-keyword">// 简化的余弦相似度计算</span>
        <span class="text-blue-300">return</span> <span class="code-class">0.0</span>;
    }

    <span class="text-gray-500">/**
     * 计算余弦相似度（完整版）
     */</span>
    <span class="code-keyword">public static</span> <span class="text-blue-300">float</span> <span class="code-class">cosineSimilarityFull</span>(<span class="code-string">String</span> text1, <span class="text-blue-300">String</span> text2) {
        <span class="code-keyword">// 考虑大小写、空格、标点符号</span>
        <span class="text-blue-300">String</span> t1 = <span class="code-class">text1</span>.<span class="code-string">toLowerCase</span>();
        <span class="code-keyword">String</span> t2 = <span class="text-blue-300">text2</span>.<span class="code-class">toLowerCase</</span>();

        <span class="text-gray-500">// 计算 Jaccard 相似度</span>
        <span class="code-keyword">int</span> intersectionSize = <span class="text-blue-300">0</span>;
        <span class="code-class">int</span> maxDistance = <span class="code-string">Math</span>.<span class="text-blue-300">min</span>(text1.<span class="code-class">length</span>(), text2.<span class="code-string">length</span>()) / <span class="text-blue-300">2</span>;

        <span class="text-gray-500">// 计算 Levenshtein 距离</span>
        <span class="code-keyword">for</span> (<span class="text-blue-300">int</span> i = <span class="code-class">0</span>; i <= maxDistance; i++) {
            <span class="code-string">if</span> (i >= t1.<span class="text-blue-300">length</span>()) <span class="code-class">intersectionSize</span>++;
            <span class="code-keyword">if</span> (t2.<span class="text-blue-300">length</span>() > <span class="code-class">i</span> t1.<span class="code-string">length</span>()) <span class="text-blue-300">intersectionSize</span>++;
        }

        <span class="text-gray-500">// 计算相似度（Jaccard / (1 + Levenshtein)）</span>
        <span class="code-keyword">float</span> jaccard = (<span class="text-blue-300">1</span> - <span class="code-class">jaccard</span>(<span class="code-string">2</span>) / <span class="text-blue-300">(1</span> + <span class="code-class">0.5f</span>);
        <span class="code-keyword">float</span> levenshtein = <span class="text-blue-300">levenshtein</span>(<span class="code-string">1</span> <span class="text-blue-300">t1</span>.<span class="code-class">substring</span>(<span class="code-string">0</span>, i, <span class="text-blue-300">Math</span>.<span class="code-class">min</span>(i + <span class="code-keyword">len2</span>(), <span class="text-blue-300">Math</span>.<span class="code-string">maxDistance</span>)));
        <span class="code-keyword">if</span> (<span class="text-blue-300">levenshtein</span> <= maxDistance) <span class="code-class">levensteinDistance</span> {
                levenshteinDistance = maxDistance;
            }

        <span class="text-gray-500">// 计算最终相似度（0-2 之间，1 表示完全不同，1 表示完全相同）</span>
        <span class="code-keyword">return</span> <span class="text-blue-300">jaccard</span> <span class="code-class">* <span class="code-string">0.7</span> <span class="text-blue-300">+</span> <span class="code-keyword">0.3</span> <span class="text-blue-300">*</span> (<span class="code-string">1</span> <span class="code-class">- jaccard</span>(<span class="text-blue-300">2</span>) / <span class="text-blue-300">(1</span> + <span class="code-class">0.5</span>);
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">2.5 完整 RAG 流程实现</h3>
                    <p class="text-gray-700 mb-4">实现端到端的 RAG 流程，结合向量检索和 LLM 生成：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">RAGService.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.rag.service</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.data.message.AiMessage</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.data.message.ChatMessage</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.data.message.UserMessage</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.ChatLanguageModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.openai.OpenAiChatModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.store.embedding.EmbeddingStore</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.stereotype.Service</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.ArrayList</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.List</span>;

<span class="text-gray-500">/**
 * RAG 服务类
 * 实现完整的检索增强生成流程
 */</span>
<span class="code-keyword">@Service</span>
<span class="code-keyword">public class</span> <span class="code-class">RAGService</span> {

    <span class="code-keyword">private final</span> <span class="text-blue-300">ChatLanguageModel</span> chatModel;
    <span class="code-keyword">private final</span> <span class="text-blue-300">EmbeddingStore</span>&lt;<span class="text-blue-300">TextSegment</span>&gt; embeddingStore;
    <span class="code-keyword">private final</span> <span class="text-blue-300">DocumentService</span> documentService;

    <span class="text-gray-500">/**
     * 检索的文档数量
     */</span>
    <span class="code-keyword">private static final int</span> <span class="code-class">TOP_K</span> = <span class="code-string">3</span>;

    <span class="code-keyword">public</span> <span class="code-class">RAGService</span>(<span class="text-blue-300">EmbeddingStore</span>&lt;<span class="text-blue-300">TextSegment</span>&gt; embeddingStore,
                         <span class="text-blue-300">DocumentService</span> documentService) {
        <span class="text-gray-500">// 初始化 Chat 模型（使用 OpenAI GPT-4）</span>
        <span class="code-keyword">this</span>.chatModel = <span class="code-class">OpenAiChatModel</span>.<span class="code-string">builder</span>()
                .<span class="code-string">apiKey</span>(<span class="code-string">System.getenv</span>(<span class="code-string">"OPENAI_API_KEY"</span>))
                .<span class="code-string">modelName</span>(<span class="code-string">"gpt-4"</span>)
                .<span class="code-string">temperature</span>(<span class="code-string">0.7</span>)
                .<span class="code-string">build</span>();
        
        <span class="code-keyword">this</span>.embeddingStore = embeddingStore;
        <span class="code-keyword">this</span>.documentService = documentService;
    }

    <span class="text-gray-500">/**
     * RAG 问答
     * 流程：查询 → 检索 → 组装 Prompt → LLM 生成
     */</span>
    <span class="code-keyword">public</span> <span class="text-blue-300">String</span> <span class="code-keyword">answer</span>(<span class="text-blue-300">String</span> question) {
        <span class="text-gray-500">// 第一步：检索相关文档</span>
        <span class="text-blue-300">List</span>&lt;<span class="text-blue-300">Document</span>&gt; relevantDocs = 
            documentService.<span class="code-string">searchDocuments</span>(question, <span class="code-class">TOP_K</span>);
        
        <span class="text-gray-500">// 第二步：构建上下文</span>
        <span class="text-blue-300">String</span> context = relevantDocs.<span class="code-string">stream</span>()
            .<span class="code-string">map</span>(doc -&gt; doc.<span class="code-string">content</span>())
            .<span class="code-string">reduce</span>((s1, s2) -&gt; s1 + <span class="code-string">"\n\n"</span> + s2)
            .<span class="code-string">orElse</span>(<span class="code-string">"No relevant documents found."</span>);
        
        <span class="text-gray-500">// 第三步：构建增强的 Prompt</span>
        <span class="text-blue-300">String</span> prompt = <span class="code-class">buildPrompt</span>(question, context);
        
        <span class="text-gray-500">// 第四步：调用 LLM 生成回答</span>
        <span class="text-blue-300">AiMessage</span> response = chatModel.<span class="code-string">generate</span>(prompt);
        
        <span class="code-keyword">return</span> response.<span class="code-string">text</span>();
    }

    <span class="text-gray-500">/**
     * 构建 RAG Prompt
     * 将问题和检索到的上下文组合成完整提示
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">String</span> <span class="code-keyword">buildPrompt</span>(<span class="text-blue-300">String</span> question, <span class="text-blue-300">String</span> context) {
        <span class="code-keyword">return</span> <span class="code-class">String</span>.<span class="code-string">format</span>(<span class="code-string">"""
            基于以下上下文信息回答问题。如果上下文中没有相关信息，请说明这一点。
            
            上下文：
            %s
            
            问题：
            %s
            
            回答：
            """</span>, context, question);
    }
}</code></pre>
                    </div>

                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 mb-8">
                        <h3 class="text-xl font-bold text-white mb-2">RAG 核心流程</h3>
                        <p class="text-indigo-100 mb-4">用户提问 → 检索 → 上下文组装 → LLM 生成</p>
                        <ul class="text-indigo-100 space-y-2">
                            <li><strong>第一步：用户提问</strong> - 通过 API 发送自然语言查询</li>
                            <li><strong>第二步：向量化</strong> - 将查询转换为向量表示</li>
                            <li><strong>第三步：相似度搜索</strong> - 在向量数据库中查找最相似的文档</li>
                            <li><strong>第四步：上下文组装</strong> - 将检索到的文档组装成 Prompt</li>
                            <li><strong>第五步：LLM 生成</strong> - 基于上下文生成准确回答</li>
                        </ul>
                    </div>
                </section>

                <!-- 第3节：AI 助手项目实战 -->
                <section id="ai助手项目实战" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">3</span>
                        <h2 class="text-2xl font-bold text-gray-900">AI 助手项目实战</h2>
                    </div>

                    <p class="paragraph">构建一个企业级智能助手，支持多模型、函数调用和上下文管理。</p>

                    <h3 class="subsection-title">3.1 系统架构设计</h3>
                    <p class="text-gray-700 mb-4">AI 助手采用模块化架构，支持插件式功能扩展：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">AiAssistantController.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.assistant</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.web.bind.annotation.*</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.Map</span>;

<span class="text-gray-500">/**
 * AI 助手 REST API 控制器
 * 提供多模型对话、函数调用、上下文管理功能
 */</span>
<span class="code-keyword">@RestController</span>
<span class="code-keyword">@RequestMapping</span>(<span class="code-string">"/api/assistant"</span>)
<span class="code-keyword">public class</span> <span class="text-blue-300">class</span> <span class="code-class">AiAssistantController</span> {

    <span class="code-keyword">private final</span> <span class="text-blue-300">AssistantService</span> assistantService;

    <span class="code-keyword">public</span> <span class="code-class">AiAssistantController</span>(<span class="text-blue-300">AssistantService</span> assistantService) {
        <span class="code-keyword">this</span>.assistantService = assistantService;
    }

    <span class="text-gray-500">/**
     * 基础对话接口
     * 支持单轮对话
     */</span>
    <span class="code-keyword">@PostMapping</span>(<span class="code-string">"/chat"</span>)
    <span class="code-keyword">public</span> <span class="code-class">ChatResponse</span> <span class="code-keyword">chat</span>(<span class="text-blue-300">@RequestBody</span> <span class="code-class">ChatRequest</span> request) {
        <span class="code-keyword">return</span> assistantService.<span class="code-string">chat</span>(
            request.<span class="code-string">getMessage</span>(),
            request.<span class="code-string">getModel</span>(),
            request.<span class="code-string">getUserId</span>()
        );
    }

    <span class="text-gray-500">/**
     * 多轮对话接口
     * 支持对话历史和上下文管理
     */</span>
    <span class="code-keyword">@PostMapping</span>(<span class="code-string">"/chat/history"</span>)
    <span class="code-keyword">public</span> <span class="code-class">ChatResponse</span> <span class="code-keyword">chatWithHistory</span>(<span class="text-blue-300">@RequestBody</span> <span class="code-class">ChatWithHistoryRequest</span> request) {
        <span class="code-keyword">return</span> assistantService.<span class="code-string">chatWithHistory</span>(
            request.<span class="code-string">getMessage</span>(),
            request.<span class="code-string">getHistory</span>(),
            request.<span class="code-string">getUserId</span>()
        );
    }

    <span class="text-gray-500">/**
     * 函数调用接口
     * 支持外部工具和 API 调用
     */</span>
    <span class="code-keyword">@PostMapping</span>(<span class="code-string">"/function"</span>)
    <span class="code-keyword">public</span> <span class="code-class">FunctionResponse</span> <span class="code-keyword">executeFunction</span>(<span class="text-blue-300">@RequestBody</span> <span class="code-class">FunctionRequest</span> request) {
        <span class="code-keyword">return</span> assistantService.<span class="code-string">executeFunction</span>(
            request.<span class="code-string">getMessage</span>(),
            request.<span class="code-string">getTools</span>()
        );
    }

    <span class="text-gray-500">/**
     * 清除对话历史
     */</span>
    <span class="code-keyword">@DeleteMapping</span>(<span class="code-string">"/history/{userId}"</span>)
    <span class="code-keyword">public</span> <span class="text-blue-300">void</span> <span class="code-keyword">clearHistory</span>(<span class="text-blue-300">@PathVariable</span> <span class="text-blue-300">String</span> userId) {
        assistantService.<span class="code-string">clearHistory</span>(userId);
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">3.2 多模型支持</h3>
                    <p class="text-gray-700 mb-4">使用工厂模式支持多种 LLM 模型：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">ModelFactory.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.assistant.model</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.ChatLanguageModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.openai.OpenAiChatModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.anthropic.AnthropicChatModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.google.GoogleGeminiChatModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.huggingface.HuggingFaceChatModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.stereotype.Component</span>;

<span class="text-gray-500">/**
 * 模型工厂类
 * 根据配置创建不同的 LLM 模型实例
 */</span>
<span class="code-keyword">@Component</span>
<span class="code-keyword">public class</span> <span class="code-class">ModelFactory</span> {

    <span class="text-gray-500">/**
     * 创建聊天语言模型
     * @param provider 模型提供商（openai、anthropic、google、huggingface）
     * @param modelName 模型名称（如 gpt-4、claude-3-opus、gemini-pro 等）
     */</span>
    <span class="code-keyword">public</span> <span class="text-blue-300">ChatLanguageModel</span> <span class="code-keyword">createModel</span>(<span class="text-blue-300">String</span> provider, <span class="text-blue-300">String</span> modelName) {
        <span class="code-keyword">return switch</span> (provider.<span class="code-string">toLowerCase</span>()) {
            <span class="code-keyword">case</span> <span class="code-string">"openai"</span> -&gt; <span class="code-keyword">createOpenAiModel</span>(modelName);
            <span class="code-keyword">case</span> <span class="code-string">"anthropic"</span> -&gt; <span class="code-keyword">createAnthropicModel</span>(modelName);
            <span class="code-keyword">case</span> <span class="code-string">"google"</span> -&gt; <span class="code-keyword">createGoogleModel</span>(modelName);
            <span class="code-keyword">case</span> <span class="code-string">"huggingface"</span> -&gt; <span class="code-keyword">createHuggingFaceModel</span>(modelName);
            <span class="code-keyword">default</span> -&gt; <span class="code-keyword">throw new</span> <span class="code-class">IllegalArgumentException</span>(
                <span class="code-string">"Unsupported provider: "</span> + provider);
        };
    }

    <span class="text-gray-500">/**
     * 创建 OpenAI 模型
     * 支持 GPT-4、GPT-3.5-turbo 等
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">ChatLanguageModel</span> <span class="code-keyword">createOpenAiModel</span>(<span class="text-blue-300">String</span> modelName) {
        <span class="code-keyword">return</span> <span class="code-class">OpenAiChatModel</span>.<span class="code-string">builder</span>()
                .<span class="code-string">apiKey</span>(<span class="code-class">System</span>.<span class="code-string">getenv</span>(<span class="code-string">"OPENAI_API_KEY"</span>))
                .<span class="code-string">modelName</span>(modelName)
                .<span class="code-string">temperature</span>(<span class="code-string">0.7</span>)
                .<span class="code-string">maxTokens</span>(<span class="code-string">2000</span>)
                .<span class="code-string">timeout</span>(<span class="code-class">java.time.Duration</span>.<span class="code-string">ofSeconds</span>(<span class="code-string">60</span>))
                .<span class="code-string">build</span>();
    }

    <span class="text-gray-500">/**
     * 创建 Anthropic 模型
     * 支持 Claude-3-opus、Claude-3-sonnet 等
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">ChatLanguageModel</span> <span class="code-keyword">createAnthropicModel</span>(<span class="text-blue-300">String</span> modelName) {
        <span class="code-keyword">return</span> <span class="code-class">AnthropicChatModel</span>.<span class="code-string">builder</span>()
                .<span class="code-string">apiKey</span>(<span class="code-class">System</span>.<span class="code-string">getenv</span>(<span class="code-string">"ANTHROPIC_API_KEY"</span>))
                .<span class="code-string">modelName</span>(modelName)
                .<span class="code-string">temperature</span>(<span class="code-string">0.7</span>)
                .<span class="code-string">maxTokens</span>(<span class="code-string">2000</span>)
                .<span class="code-string">build</span>();
    }

    <span class="text-gray-500">/**
     * 创建 Google Gemini 模型
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">ChatLanguageModel</span> <span class="code-keyword">createGoogleModel</span>(<span class="text-blue-300">String</span> modelName) {
        <span class="code-keyword">return</span> <span class="code-class">GoogleGeminiChatModel</span>.<span class="code-string">builder</span>()
                .<span class="code-string">apiKey</span>(<span class="code-class">System</span>.<span class="code-string">getenv</span>(<span class="code-string">"GOOGLE_API_KEY"</span>))
                .<span class="code-string">modelName</span>(modelName)
                .<span class="code-string">temperature</span>(<span class="code-string">0.7</span>)
                .<span class="code-string">build</span>();
    }

    <span class="text-gray-500">/**
     * 创建 Hugging Face 模型
     * 支持开源模型（如 Llama 2、Mistral 等）
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">ChatLanguageModel</span> <span class="code-keyword">createHuggingFaceModel</span>(<span class="text-blue-300">String</span> modelName) {
        <span class="code-keyword">return</span> <span class="code-class">HuggingFaceChatModel</span>.<span class="code-string">builder</span>()
                .<span class="code-string">accessToken</span>(<span class="code-class">System</span>.<span class="code-string">getenv</span>(<span class="code-string">"HUGGINGFACE_API_KEY"</span>))
                .<span class="code-string">modelId</span>(modelName)
                .<span class="code-string">temperature</span>(<span class="code-string">0.7</span>)
                .<span class="code-string">maxNewTokens</span>(<span class="code-string">2000</span>)
                .<span class="code-string">build</span>();
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">3.3 函数调用实现</h3>
                    <p class="text-gray-700 mb-4">使用 LangChain4j 的 Function Calling 功能调用外部工具：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">WeatherTool.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.assistant.tool</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.agent.tool.Tool</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.stereotype.Component</span>;

<span class="text-gray-500">/**
 * 天气查询工具
 * 演示函数调用能力
 */</span>
<span class="code-keyword">@Component</span>
<span class="code-keyword">public class</span> <span class="code-class">WeatherTool</span> {

    <span class="text-gray-500">/**
     * 查询实时天气
     * @Tool 注解标记此方法为可调用函数
     */</span>
    <span class="code-keyword">@Tool</span>(<span class="code-string">"Get current weather for a city"</span>)
    <span class="code-keyword">public</span> <span class="text-blue-300">String</span> <span class="code-keyword">getWeather</span>(<span class="text-blue-300">@ToolParam</span>(<span class="code-string">"name of the city"</span>) <span class="text-blue-300">String</span> city) {
        <span class="text-gray-500">// 实际项目中，这里会调用真实天气 API</span>
        <span class="code-keyword">return</span> <span class="code-keyword">getWeatherFromApi</span>(city);
    }

    <span class="text-gray-500">/**
     * 查询天气预报
     */</span>
    <span class="code-keyword">@Tool</span>(<span class="code-string">"Get weather forecast for the next few days"</span>)
    <span class="code-keyword">public</span> <span class="text-blue-300">String</span> <span class="code-keyword">getForecast</span>(<span class="text-blue-300">@ToolParam</span>(<span class="code-string">"name of the city"</span>) <span class="text-blue-300">String</span> city,
                                  <span class="text-blue-300">@ToolParam</span>(<span class="code-string">"number of days to forecast"</span>) <span class="text-blue-300">int</span> days) {
        <span class="code-keyword">return</span> <span class="code-keyword">getForecastFromApi</span>(city, days);
    }

    <span class="code-keyword">private</span> <span class="text-blue-300">String</span> <span class="code-keyword">getWeatherFromApi</span>(<span class="text-blue-300">String</span> city) {
        <span class="text-gray-500">// 模拟天气数据</span>
        <span class="code-keyword">return</span> <span class="code-class">String</span>.<span class="code-string">format</span>(
            <span class="code-string">"Current weather in %s: 25°C, Sunny with light breeze"</span>, city);
    }

    <span class="code-keyword">private</span> <span class="text-blue-300">String</span> <span class="code-keyword">getForecastFromApi</span>(<span class="text-blue-300">String</span> city, <span class="text-blue-300">int</span> days) {
        <span class="text-gray-500">// 模拟天气预报数据</span>
        <span class="text-blue-300">StringBuilder</span> forecast = <span class="code-keyword">new</span> <span class="code-class">StringBuilder</span>();
        forecast.<span class="code-string">append</span>(<span class="code-class">String</span>.<span class="code-string">format</span>(<span class="code-string">"%d-day forecast for %s:\n"</span>, days, city));
        
        <span class="code-keyword">for</span> (<span class="text-blue-300">int</span> i = <span class="code-string">1</span>; i &lt;= days; i++) {
            forecast.<span class="code-string">append</span>(<span class="code-class">String</span>.<span class="code-string">format</span>(
                <span class="code-string">"  Day %d: 23-27°C, Mostly sunny\n"</span>, i));
        }
        
        <span class="code-keyword">return</span> forecast.<span class="code-string">toString</span>();
    }
}</code></pre>
                    </div>

                    <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-6 mb-8">
                        <h3 class="text-xl font-bold text-white mb-2">AI 助手核心功能</h3>
                        <ul class="text-purple-100 space-y-2">
                            <li><strong>多模型支持</strong> - OpenAI、Anthropic、Google、HuggingFace</li>
                            <li><strong>函数调用</strong> - 自动调用外部工具和 API</li>
                            <li><strong>上下文管理</strong> - 维护对话历史和状态</li>
                            <li><strong>灵活配置</strong> - 温度、Token 限制、超时等参数可调</li>
                        </ul>
                    </div>
                </section>

                <!-- 第4节：聊天机器人项目实战 -->
                <section id="聊天机器人项目实战" class="mb-16">
                    <div class="flex items-center gap-3 mb-6">
                        <span class="flex items-center justify-center w-8 h-8 bg-indigo-600 text-white rounded-full text-sm font-bold">4</span>
                        <h2 class="text-2xl font-bold text-gray-900">聊天机器人项目实战</h2>
                    </div>

                    <p class="paragraph">构建一个实时聊天机器人，支持多用户并发、WebSocket 实时通信和消息持久化。</p>

                    <h3 class="subsection-title">4.1 系统架构设计</h3>
                    <p class="text-gray-700 mb-4">聊天机器人采用前后端分离架构，WebSocket 实现实时通信：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">ChatWebSocketHandler.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.chatbot.websocket</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.chat.ChatLanguageModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">dev.langchain4j.model.openai.OpenAiChatModel</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.stereotype.Component</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.web.socket.*</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.concurrent.ConcurrentHashMap</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.Map</span>;

<span class="text-gray-500">/**
 * WebSocket 处理器
 * 处理实时聊天消息和连接管理
 */</span>
<span class="code-keyword">@Component</span>
<span class="code-keyword">public class</span> <span class="code-class">ChatWebSocketHandler</span> <span class="code-keyword">implements</span> <span class="code-class">WebSocketHandler</span> {

    <span class="code-keyword">private final</span> <span class="text-blue-300">ChatLanguageModel</span> chatModel;
    <span class="code-keyword">private final</span> <span class="text-blue-300">MessageService</span> messageService;
    
    <span class="text-gray-500">// 存储活跃的 WebSocket 会话（用户 ID -&gt; Session）</span>
    <span class="code-keyword">private final</span> <span class="text-blue-300">Map</span>&lt;<span class="text-blue-300">String</span>, <span class="text-blue-300">WebSocketSession</span>&gt; sessions = <span class="code-keyword">new</span> <span class="code-class">ConcurrentHashMap</span>&lt;&gt;();

    <span class="code-keyword">public</span> <span class="code-class">ChatWebSocketHandler</span>(<span class="text-blue-300">MessageService</span> messageService) {
        <span class="code-keyword">this</span>.chatModel = <span class="code-class">OpenAiChatModel</span>.<span class="code-string">builder</span>()
                .<span class="code-string">apiKey</span>(<span class="code-class">System</span>.<span class="code-string">getenv</span>(<span class="code-string">"OPENAI_API_KEY"</span>))
                .<span class="code-string">modelName</span>(<span class="code-string">"gpt-4"</span>)
                .<span class="code-string">temperature</span>(<span class="code-string">0.8</span>)
                .<span class="code-string">build</span>();
        <span class="code-keyword">this</span>.messageService = messageService;
    }

    <span class="text-gray-500">/**
     * 连接建立
     */</span>
    <span class="code-keyword">@Override</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">afterConnectionEstablished</span>(<span class="text-blue-300">WebSocketSession</span> session) <span class="code-keyword">throws</span> <span class="text-blue-300">Exception</span> {
        <span class="text-blue-300">String</span> userId = <span class="code-keyword">getUserIdFromSession</span>(session);
        sessions.<span class="code-string">put</span>(userId, session);
        
        <span class="text-gray-500">// 发送欢迎消息</span>
        <span class="code-keyword">sendMessage</span>(session, <span class="code-string">"Welcome! How can I help you today?"</span>);
    }

    <span class="text-gray-500">/**
     * 接收消息
     */</span>
    <span class="code-keyword">@Override</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">handleMessage</span>(<span class="text-blue-300">WebSocketSession</span> session, <span class="text-blue-300">WebSocketMessage</span>&lt;?&gt; message) <span class="code-keyword">throws</span> <span class="text-blue-300">Exception</span> {
        <span class="text-blue-300">String</span> userId = <span class="code-keyword">getUserIdFromSession</span>(session);
        <span class="text-blue-300">String</span> userMessage = message.<span class="code-string">getPayload</span>().<span class="code-string">toString</span>();
        
        <span class="text-gray-500">// 1. 保存用户消息</span>
        messageService.<span class="code-string">saveMessage</span>(userId, <span class="code-string">"user"</span>, userMessage);
        
        <span class="text-gray-500">// 2. 获取对话历史</span>
        <span class="text-blue-300">List</span>&lt;<span class="text-blue-300">ChatMessage</span>&gt; history = messageService.<span class="code-string">getRecentHistory</span>(userId, <span class="code-string">10</span>);
        
        <span class="text-gray-500">// 3. 生成 AI 回复</span>
        <span class="text-blue-300">String</span> aiResponse = <span class="code-keyword">generateResponse</span>(userMessage, history);
        
        <span class="text-gray-500">// 4. 保存 AI 回复</span>
        messageService.<span class="code-string">saveMessage</span>(userId, <span class="code-string">"assistant"</span>, aiResponse);
        
        <span class="text-gray-500">// 5. 发送回复给用户</span>
        <span class="code-keyword">sendMessage</span>(session, aiResponse);
    }

    <span class="text-gray-500">/**
     * 连接关闭
     */</span>
    <span class="code-keyword">@Override</span>
    <span class="code-keyword">public void</span> <span class="code-keyword">afterConnectionClosed</span>(<span class="text-blue-300">WebSocketSession</span> session, <span class="text-blue-300">CloseStatus</span> status) <span class="code-keyword">throws</span> <span class="text-blue-300">Exception</span> {
        <span class="text-blue-300">String</span> userId = <span class="code-keyword">getUserIdFromSession</span>(session);
        sessions.<span class="code-string">remove</span>(userId);
    }

    <span class="text-gray-500">/**
     * 生成 AI 回复
     */</span>
    <span class="code-keyword">private</span> <span class="text-blue-300">String</span> <span class="code-keyword">generateResponse</span>(<span class="text-blue-300">String</span> message, <span class="text-blue-300">List</span>&lt;<span class="text-blue-300">ChatMessage</span>&gt; history) {
        <span class="text-gray-500">// 构建完整的对话上下文</span>
        <span class="text-blue-300">StringBuilder</span> context = <span class="code-keyword">new</span> <span class="code-class">StringBuilder</span>();
        <span class="code-keyword">for</span> (<span class="text-blue-300">ChatMessage</span> msg : history) {
            context.<span class="code-string">append</span>(msg.<span class="code-string">getRole</span>()).<span class="code-string">append</span>(<span class="code-string">": "</span>)
                  .<span class="code-string">append</span>(msg.<span class="code-string">getContent</span>()).<span class="code-string">append</span>(<span class="code-string">"\n"</span>);
        }
        
        <span class="text-gray-500">// 调用 LLM 生成回复</span>
        <span class="text-blue-300">String</span> prompt = context + <span class="code-string">"\nUser: "</span> + message + <span class="code-string">"\nAssistant:"</span>;
        <span class="code-keyword">return</span> chatModel.<span class="code-string">generate</span>(prompt).<span class="code-string">content</span>();
    }

    <span class="code-keyword">private</span> <span class="text-blue-300">String</span> <span class="code-keyword">getUserIdFromSession</span>(<span class="text-blue-300">WebSocketSession</span> session) {
        <span class="code-keyword">return</span> session.<span class="code-string">getUri</span>().<span class="code-string">getQuery</span>().<span class="code-string">split</span>(<span class="code-string">"="</span>)[<span class="code-string">1</span>];
    }

    <span class="code-keyword">private void</span> <span class="code-keyword">sendMessage</span>(<span class="text-blue-300">WebSocketSession</span> session, <span class="text-blue-300">String</span> message) <span class="code-keyword">throws</span> <span class="text-blue-300">Exception</span> {
        <span class="code-keyword">if</span> (session.<span class="code-string">isOpen</span>()) {
            session.<span class="code-string">sendMessage</span>(<span class="code-keyword">new</span> <span class="code-class">TextMessage</span>(message));
        }
    }
}</code></pre>
                    </div>

                    <h3 class="subsection-title">4.2 用户认证与会话管理</h3>
                    <p class="text-gray-700 mb-4">使用 JWT 进行用户认证，Redis 管理会话状态：</p>

                    <div class="code-wrapper">
                        <div class="code-filename-badge">AuthService.java</div>
                        <pre class="bg-gray-900 text-gray-100 rounded-lg p-5 overflow-x-auto"><code class="text-sm"><span class="code-keyword">package</span> <span class="text-blue-300">com.example.langchain4j.chatbot.auth</span>;

<span class="code-keyword">import</span> <span class="text-blue-300">io.jsonwebtoken.Jwts</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">io.jsonwebtoken.security.Keys</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">org.springframework.stereotype.Service</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.security.Key</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.Date</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.HashMap</span>;
<span class="code-keyword">import</span> <span class="text-blue-300">java.util.Map</span>;

<span class="text-gray-500">/**
 * 认证服务
 * 处理用户登录和 JWT Token 生成
 */</span>
<span class="code-keyword">@Service</span>
<span class="code-keyword">public class</span> <span class="code-class">AuthService</span> {

    <span class="code-keyword">private static final</span> <span class="text-blue-300">String</span> <span class="code-class">SECRET_KEY</span> = <span class="code-string">"your-secret-key-at-least-256-bits-long"</span>;
    <span class="code-keyword">private static final long</span> <span class="code-class">EXPIRATION_TIME</span> = <span class="code-string">86400000</span>;  <span class="text-gray-500">// 24 小时</span>
    <span class="code-keyword">private static final</span> <span class="text-blue-300">Key</span> <span class="code-class">signingKey</span> = <span class="code-class">Keys</span>.<span class="code-string">hmacShaKeyFor</span>(<span class="code-class">SECRET_KEY</span>.<span class="code-string">getBytes</span>());

    <span class="text-gray-500">/**
     * 生成 JWT Token
     */</span>
    <span class="code-keyword">public</span> <span class="text-blue-300">String</span> <span class="code-keyword">generateToken</span>(<span class="text-blue-300">String</span> userId) {
        <span class="text-blue-300">Map</span>&lt;<span class="text-blue-300">String</span>, <span class="text-blue-300">Object</span>&gt; claims = <span class="code-keyword">new</span> <span class="code-class">HashMap</span>&lt;&gt;();
        claims.<span class="code-string">put</span>(<span class="code-string">"userId"</span>, userId);
        
        <span class="code-keyword">return</span> <span class="code-class">Jwts</span>.<span class="code-string">builder</span>()
                .<span class="code-string">setClaims</span>(claims)
                .<span class="code-string">setSubject</span>(userId)
                .<span class="code-string">setIssuedAt</span>(<span class="code-keyword">new</span> <span class="code-class">Date</span>())
                .<span class="code-string">setExpiration</span>(<span class="code-keyword">new</span> <span class="code-class">Date</span>(<span class="code-class">System</span>.<span class="code-string">currentTimeMillis</span>() + <span class="code-class">EXPIRATION_TIME</span>))
                .<span class="code-string">signWith</span>(<span class="code-class">signingKey</span>)
                .<span class="code-string">compact</span>();
    }

    <span class="text-gray-500">/**
     * 验证 JWT Token
     */</span>
    <span class="code-keyword">public</span> <span class="text-blue-300">String</span> <span class="code-keyword">validateToken</span>(<span class="text-blue-300">String</span> token) {
        <span class="code-keyword">try</span> {
            <span class="text-blue-300">String</span> userId = <span class="code-class">Jwts</span>.<span class="code-string">parserBuilder</span>()
                    .<span class="code-string">setSigningKey</span>(<span class="code-class">signingKey</span>)
                    .<span class="code-string">build</span>()
                    .<span class="code-string">parseClaimsJws</span>(token)
                    .<span class="code-string">getBody</span>()
                    .<span class="code-string">getSubject</span>();
            <span class="code-keyword">return</span> userId;
        } <span class="code-keyword">catch</span> (<span class="text-blue-300">Exception</span> e) {
            <span class="code-keyword">throw new</span> <span class="code-class">RuntimeException</span>(<span class="code-string">"Invalid token"</span>, e);
        }
    }
}</code></pre>
                    </div>

                    <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-xl p-6 mb-8">
                        <h3 class="text-xl font-bold text-white mb-2">聊天机器人核心功能</h3>
                        <ul class="text-orange-100 space-y-2">
                            <li><strong>WebSocket 实时通信</strong> - 低延迟双向消息传输</li>
                            <li><strong>用户认证</strong> - JWT Token 安全认证</li>
                            <li><strong>消息持久化</strong> - PostgreSQL 存储聊天历史</li>
                            <li><strong>多用户并发</strong> - 支持多个用户同时在线</li>
                            <li><strong>上下文管理</strong> - 维护对话历史和状态</li>
                        </ul>
                    </div>
                </section>

                <!-- 总结 -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-8 text-white">
                    <h3 class="text-2xl font-bold mb-4">本节小结</h3>
                    <p class="mb-4">本节完整介绍了三个实战项目的架构设计和核心实现，涵盖了：</p>
                    <ul class="list-disc list-inside space-y-2 mb-6">
                        <li><strong>RAG 知识库</strong>：文档向量化、向量检索、智能问答</li>
                        <li><strong>AI 助手</strong>：多模型支持、函数调用、上下文管理</li>
                        <li><strong>聊天机器人</strong>：实时通信、用户认证、消息持久化</li>
                    </ul>
                    <div class="border-t border-indigo-400 pt-6">
                        <p class="text-sm opacity-80 mb-2">统一技术栈</p>
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">LangChain4j</span>
                            <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm">Spring Boot 3.2.x</span>
                            <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">PostgreSQL</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">Redis</span>
                            <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">PGVector</span>
                            <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">WebSocket</span>
                        </div>
                    </div>
                    <div class="border-t border-indigo-400 pt-6 mt-6">
                        <p class="text-sm opacity-80 mb-2">下一步</p>
                        <a href="search.html" class="inline-flex items-center gap-2 text-white hover:text-indigo-200 transition-colors">
                            下一章：搜索功能 →
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
